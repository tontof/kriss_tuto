<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>PHP</title>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="../common/lib/reveal/css/reveal.css"/>

<link rel="stylesheet" href="../common/lib/reveal/css/theme/serif.css" id="theme"/>

<link rel="stylesheet" href="../common/inc/css/htmlize.css"/>

<link rel="stylesheet" href="../common/lib/codemirror/codemirror.css"/>

<link rel="stylesheet" href="../common/lib/codemirror/theme/dracula.css"/>

<link rel="stylesheet" href="../common/inc/css/custom.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '../common/lib/reveal/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="../common/lib/mathjax/mathjax.js"></script>
</head>
<body>
<!-- If the query includes 'print-pdf', include the PDF print sheet --><script>if( window.location.search.match( /print-pdf/gi ) ) { var link = document.createElement( 'link' ); link.rel = 'stylesheet'; link.type = 'text/css'; link.href = '../common/inc/css/custom-pdf.css'; document.getElementsByTagName( 'head' )[0].appendChild( link ); }</script><div id="reveal-notes"></div><div id="editor"><div><div id="php-source"><textarea></textarea></div><div id="php-html-gutter" class="gutter"></div><div id="html-source"><textarea></textarea></div><div id="html-gutter" class="gutter"></div><div id="html-output"></div></div><button id="editor-clear">Clear</button><button id="editor-mode">Mode PHP/HTML</button><button id="editor-close">Close</button><button id="editor-run">Run</button></div>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">PHP</h1>
</section>
<section id="table-of-contents"><div id="table-of-contents">
<h2>Table des matières</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#/slide-org2eefab3">1. Les bases en PHP</a></li>
<li><a href="#/slide-orgb836044">2. Les formulaires</a></li>
<li><a href="#/slide-org41b8091">3. Cookies et sessions</a></li>
<li><a href="#/slide-org87cdd1d">4. PHP et les fichiers</a></li>
<li><a href="#/slide-org4a83edb">5. Bases de données SQL</a></li>
</ul>
</div>
</div>
</section>

<section id="slide-org2eefab3">
<h2 id="org2eefab3"><span class="section-number-2">1</span> Les bases en PHP</h2>
<aside class="notes">
<ul>
<li>HTML, CSS et JS sont des langages interprétés par un navigateur
côté client</li>
<li>PHP s'utilise côté serveur et permet de générer du contenu HTML
<ul>
<li>en pratique PHP peut générer n'importe quel type de contenu mais
nous nous limiterons à du HTML pour ce cours</li>

</ul></li>
<li>Afin de stocker des informations de manière durable, nous verrons
comment manipuler des fichiers et des bases de données SQL avec PHP</li>

</ul>

</aside>

</section>
<section id="slide-org4a65234">
<h3 id="org4a65234"><span class="section-number-3">1.1</span> Pourquoi PHP ?</h3>

<div class="figure">
<p><a href="http://www.commitstrip.com/fr/2015/01/12/the-right-tool-for-the-right-job/"><img src="./inc/img/Strip-PHP-doute650-Web.jpg" alt="Strip-PHP-doute650-Web.jpg" /></a>
</p>
</div>

<aside class="notes">
<ul>
<li>la langage PHP est souvent critiqué mais il reste quand même
majoritairement le langage le plus utilisé pour réaliser un site
sur le web un peu moins de 80%</li>
<li><a href="https://w3techs.com/technologies/history_overview/programming_language">https://w3techs.com/technologies/history_overview/programming_language</a></li>

</ul>

</aside>

</section>
<section id="slide-orgb2e7b06">
<h3 id="orgb2e7b06"><span class="section-number-3">1.2</span> Introduction à PHP</h3>
<ul>
<li><b><a href="http://php.net">PHP</a></b> (PHP: Hypertext Preprocessor)</li>
<li>Langage de programmation
<ul>
<li>impératif, procédural (suite d'instructions)</li>
<li>interprété côté serveur</li>
<li>libre</li>

</ul></li>
<li>Pages Web dynamiques</li>
<li>Logo : <img src="./inc/img/php.png" alt="php.png" /></li>
<li>Mascotte (Elephpant) : <img src="./inc/img/elephpant.png" alt="elephpant.png" /></li>

</ul>

<aside class="notes">
<ul>
<li>PHP est initialement proche du langage C</li>
<li>Il permet de rendre un site dynamique</li>

</ul>

</aside>

</section>
<section id="slide-org07665ed">
<h4 id="org07665ed"><span class="section-number-4">1.2.1</span> Quelques versions de php</h4>
<ul>
<li><code>1.0 : 1995      :</code> <i>PHP: Personal Home Page</i></li>
<li><code>2.0 : 1997      :</code> Base du langage PHP actuel</li>
<li><code>3.0 : 1998-2000 :</code> <i>PHP: Hypertext Preprocessor</i></li>
<li><code>4.0 : 2000-2001 :</code> Zend engine</li>
<li><code>4.3 : 2002-2005 :</code> <i>CLI: Command line interface</i></li>
<li><code>5.0 : 2004-2005 :</code> Zend engine 2, Programmation objet</li>
<li><code>5.3 : 2009-2014 :</code> Namespace, closure</li>
<li><code>5.4 : 2012-2015 :</code> Trait</li>
<li><code>6.0 : ......... :</code> Unicode</li>
<li><code>7.0 : 2015-2018 :</code> Zend engine 3</li>

</ul>

<aside class="notes">
<ul>
<li>PHP évolue et s'utilise de plus en plus avec le paradigme de la programmation orientée objet.</li>
<li>Comme pour javascript, nous ne nous attarderons pas sur cet aspect et nous nous limiterons aux bases de PHP.</li>

</ul>

</aside>

</section>
<section id="slide-hello-world">
<h4 id="hello-world"><a id="orgda87601"></a><span class="section-number-4">1.2.2</span> Hello world</h4>
<ul>
<li>Créer un fichier avec l'extension .php</li>
<li>Insérer du code HTML et/ou PHP</li>
<li>Le code PHP doit être délimité par les balises <code>&lt;?php</code> et <code>?&gt;</code></li>
<li>Les instructions se terminent par <code>;</code></li>
<li>Les commentaires sont délimités par :
<ul>
<li><code>//</code> pour un commentaire sur une ligne</li>
<li><code>/*</code> pour un commentaire sur plusieurs lignes <code>*/</code></li>

</ul></li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-hello"><code trim>&lt;em&gt;&lt;?php
//* Comment hack
echo 'Hello world';
// */
?&gt;&lt;/em&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Dans cet exemple simple, on souhaite afficher la chaîne de
caractères « Hello world »</li>
<li>En cliquant sur le bouton « Run » une fenêtre découpée en 3 vous affichera
<ul>
<li>à gauche le code PHP</li>
<li>en haut à droite le résultat du code PHP (la génération du code
HTML généré)</li>
<li>en bas à droite l'affichage du code HTML par le navigateur</li>

</ul></li>
<li>Cliquer de nouveau sur le bouton « Run » pour voir le résultat</li>

</ul>


<ul>
<li>Le comment hack est une illustration pour vous montrer comment
commenter/décommenter rapidement un bloc de code</li>
<li>En supprimant le premier <code>/</code> le code complet est commenté
transformant le code <code>//*</code> par un <code>/*</code> passant d'un commentaire
sur une ligne à un commentaire sur un bloc qui se termine grâce au
code <code>// */</code> qui combine le commentaire linéaire et le commentaire
fin de bloc.</li>

</ul>

</aside>

</section>
<section id="slide-orgee35a06">
<h3 id="orgee35a06"><span class="section-number-3">1.3</span> Les types en PHP</h3>
<ul>
<li>types simples :
<ul>
<li>boolean</li>
<li>integer</li>
<li>float (avant double)</li>
<li>string</li>

</ul></li>
<li>types composés :
<ul>
<li>array (tableau)</li>
<li><i>object (objet)</i></li>

</ul></li>
<li>types spéciaux :
<ul>
<li><i>resource</i></li>
<li>NULL</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>PHP n'est pas un langage fortement typé contrairement au langage
C. Il se rapproche sur point avec javascriptq</li>
<li>Nous allons préciser chaque type sauf les types 'object' et
'resource' que nous aborderons plus tard.</li>

</ul>

</aside>

</section>
<section id="slide-org13a073c">
<h4 id="org13a073c"><span class="section-number-4">1.3.1</span> Les booléens (boolean)</h4>
<ul>
<li>Type le plus simple pour exprimer une valeur de vérité.</li>
<li>Deux constantes insensibles à la casse :
<ul>
<li>TRUE (vrai)</li>
<li>FALSE (faux)</li>

</ul></li>

</ul>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-true"><code trim>&lt;?php echo TRUE; ?&gt; 
&lt;?php echo true; ?&gt; 
&lt;?php var_dump(TRUE); ?&gt; 
</code></pre>
</div>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-false"><code trim>&lt;?php echo FALSE; ?&gt; 
&lt;?php echo false; ?&gt; 
&lt;?php var_dump(FALSE); ?&gt; 
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Le type booléen représente la notion vrai/faux</li>
<li>La fonction <code>var_dump</code> permet d'afficher des informations
précises sur le paramètre donné.</li>
<li>On peut remarquer que l'affichage de <code>false</code> n'affiche pas <code>0</code>
contrairement à ce qu'on aurait pu penser après avoir vu que
<code>true</code> affichait <code>1</code></li>

</ul>

</aside>

</section>
<section id="slide-org533c550">
<h4 id="org533c550"><span class="section-number-4">1.3.2</span> Les booléens (cast)</h4>
<ul>
<li>On utilise <code>(bool)</code> ou <code>(boolean)</code></li>
<li>Quand on convertit une valeur en booléen, sont considérés <code>false</code>  :
<ul>
<li>le booléen <code>false</code></li>
<li>l'entier <code>0</code></li>
<li>le réel <code>0.0</code></li>
<li>la chaîne vide <code> "" </code> et la chaîne <code> "0" </code></li>
<li>tout tableau vide</li>
<li>tout objet sans membre ni variable (PHP4)</li>
<li>le type <code>NULL</code> (ainsi que les variables non définies)</li>

</ul></li>
<li>Toutes les autres valeurs sont considérées comme <code>true</code></li>

</ul>

<aside class="notes">
<ul>
<li>De façon générale, il faut faire attention avec la conversion des types.</li>

</ul>

</aside>

</section>
<section id="slide-org2da95f4">
<h4 id="org2da95f4"><span class="section-number-4">1.3.3</span> Les booléens (exemple)</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-boolean"><code trim>&lt;?php
  var_dump((bool) ""); 
  var_dump((bool) 1); 
  var_dump((bool) -2); 
  var_dump((bool) "foo"); 
  var_dump((bool) 2.3); 
  var_dump((bool) array(12)); 
  var_dump((bool) array()); 
  var_dump((bool) "false"); 
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer d'anticiper les résultats pour voir si vous avez bien
compris la conversion en booléen.</li>

</ul>

</aside>

</section>
<section id="slide-org881c1f9">
<h4 id="org881c1f9"><span class="section-number-4">1.3.4</span> Les entiers (integer)</h4>
<ul>
<li>Un entier est un nombre de \({\mathbb{Z} = \{ \dots, -2, -1, 0, 1, 2, \dots\}}\)</li>
<li>Il peut se définir en :
<ul>
<li>décimal (base 10) : <span style="color:chocolate">42</span></li>
<li>hexadécimal (base 16) : <span style="color:chocolate">0x2A</span></li>
<li>octal (base 8) : <span style="color:chocolate">052</span></li>
<li>binaire (base 2) :  <span style="color:chocolate">0b101010</span> (PHP 5.4)</li>

</ul></li>
<li>Il peut être précédé du signe <code>-</code> ou <code>+</code></li>

</ul>

<aside class="notes">
<ul>
<li>Il existe différentes notations pour les entiers mais en pratique
la base décimale est celle qui est pratiquement toujours utilisée.</li>

</ul>

</aside>

</section>
<section id="slide-org224e00f">
<h4 id="org224e00f"><span class="section-number-4">1.3.5</span> Les entiers (définis formellement)</h4>
<div class="org-src-container">

<pre  class="src src-text"><code trim>decimal     : [1-9][0-9]*      
            | 0                

hexadecimal : 0[xX][0-9a-fA-F]+

octal       : 0[0-7]+          

binary      : 0b[01]+          

integer     : [+-]?decimal     
            | [+-]?hexadecimal 
            | [+-]?octal       
            | [+-]?binary      
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Cette notation formelle est juste présente pour illustrer la
définition des entiers en PHP.</li>
<li>Par exemple pour la notation décimale, un entier en PHP correspond
à un '0' ou un nombre qui commence par 1, 2, &#x2026;, 9 suit ou pas
d'un autre chiffre compris entre 0 et 9</li>

</ul>

</aside>

</section>
<section id="slide-org5a23b4f">
<h4 id="org5a23b4f"><span class="section-number-4">1.3.6</span> Les entiers (cast)</h4>
<ul>
<li>On utilise <code>(int)</code> ou <code>(integer)</code></li>
<li><code>false</code> correspond à <code>0</code> et <code>true</code> à <code>1</code></li>
<li>Un réel sera arrondi vers <code>0</code></li>
<li>Seule la partie initiale d'une chaîne de caractères est prise en compte</li>
<li>Faire attention de manière générale à la conversion des autres types</li>

</ul>

<aside class="notes">
<ul>
<li>De façon générale, il faut faire attention avec la conversion des types.</li>

</ul>

</aside>

</section>
<section id="slide-org83e8715">
<h4 id="org83e8715"><span class="section-number-4">1.3.7</span> Les réels (float/double)</h4>
<ul>
<li>Un réel (nombre à virgule flottante) appartient à \({\mathbb{R}}\)</li>
<li>La taille d'un réel dépend de la plateforme, mais en général
<ul>
<li>max = ~1.8e308</li>
<li>précision de 14 chiffres</li>

</ul></li>
<li>Attention à la perte de précision : <a href="http://www.floating-point-gui.de/">http://www.floating-point-gui.de/</a></li>

</ul>

<aside class="notes">
<ul>
<li>De façon générale, il faut faire attention avec la conversion des types.</li>
<li>la perte de précision vient du fait de la représentation des
réels avec un ordinateur qui ne sait manipuler que des '0' et des
'1 et qui ne peut donc avoir que des représentations approchées
de ces réels. Un exemple concret sera donné par la suite</li>

</ul>

</aside>

</section>
<section id="slide-org265c945">
<h4 id="org265c945"><span class="section-number-4">1.3.8</span> Les réels (définis formellement)</h4>
<div class="org-src-container">

<pre  class="src src-text"><code trim>LNUM          [0-9]+                                   
DNUM          ([0-9]*[\.]{LNUM}) | ({LNUM}[\.][0-9]*)  
EXPONENT_DNUM [+-]?(({LNUM} | {DNUM}) [eE][+-]? {LNUM})
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Définition formelle des réels en PHP.</li>

</ul>

</aside>

</section>
<section id="slide-org2c83cf9">
<h4 id="org2c83cf9"><span class="section-number-4">1.3.9</span> Les réels (cast)</h4>
<ul>
<li>On utilise <code>(float)</code> ou <code>(double)</code></li>
<li>Seule la partie initiale d'une chaîne de caractères est prise en compte</li>
<li>Pour les autres types, l'élément est d'abord converti en <code>int</code> puis en <code>float</code></li>

</ul>

<aside class="notes">
<ul>
<li>De façon générale, il faut faire attention avec la conversion des types.</li>

</ul>

</aside>

</section>
<section id="slide-org4b6c5b2">
<h4 id="org4b6c5b2"><span class="section-number-4">1.3.10</span> Les entiers et les réels (exemple)</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-int-float"><code trim>&lt;?php
//*
  var_dump(42); 
  var_dump(-42); 
  var_dump(052); 
  var_dump(0x2A); 
  var_dump((int)4.2);
  var_dump((int)"la réponse est 42");
  var_dump((int)"42, la réponse est");
  var_dump((float)"42.0 42");
// */
// Floating point problem
/*
  var_dump((int) ((0.1+0.7)*10)); 
  var_dump((int)1.999999999999999);
  var_dump((int)1.9999999999999999);
// */
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer de trouver le résultat avant d'exécuter le code.</li>
<li>Commenter ensuite le code en supprimant le premier '/' petit
rappel du comment hack</li>
<li>Décommenter le code en bas en ajoutant un '/' au bon endroit et
essayer de trouver le résultat avant l'exécution. Si vous n'avez
pas la bonne réponse c'est que vous venez de découvrir le Floating
point problem sinon c'est que vous l'avez compris.</li>

</ul>

</aside>

</section>
<section id="slide-orgeca0127">
<h4 id="orgeca0127"><span class="section-number-4">1.3.11</span> Les chaînes de caractères (string)</h4>
<ul>
<li>Une chaîne de caractères correspond à un tableau d'octets.</li>
<li>Elle se définit à l'aide des <code> ' </code> ou <code> " </code></li>
<li>Les guillemets simples :
<ul>
<li>pour afficher <code> ' </code> il faut le préfixer par <code>\</code></li>
<li>pour afficher <code>\</code> il faut utiliser <code>\\</code></li>
<li>tous les autres caractères préfixés par <code>\</code> sont affichés (<code>\n</code>, <code>\r</code>)</li>

</ul></li>
<li>Les guillemets doubles :
<ul>
<li>pour afficher <code> " </code> il faut le préfixer par <code>\</code></li>
<li>les caractères préfixés par <code>\</code> sont interprêtés</li>
<li>les variables sont également interprêtées</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>De façon générale essayer d'utiliser les guillemets simples qui
sont plus efficaces pour représenter les chaînes de caractères.</li>

</ul>

</aside>

</section>
<section id="slide-org2e71028">
<h4 id="org2e71028"><span class="section-number-4">1.3.12</span> Les chaînes de caractères (cast)</h4>
<ul>
<li>On utilise <code>(string)</code></li>
<li>Convertion automatique avec certaines fonctions comme <code>echo</code>, <code>print</code></li>
<li><code>true</code> est converti en <code> "1" </code> et <code>false</code> en <code> "" </code></li>

</ul>

<aside class="notes">
<ul>
<li>De façon générale, il faut faire attention avec la conversion des types.</li>

</ul>

</aside>

</section>
<section id="slide-org890d1a3">
<h4 id="org890d1a3"><span class="section-number-4">1.3.13</span> Les chaînes de caractères (affichage)</h4>
<ul>
<li><code>echo</code> et <code>print</code> ne sont pas de vraies fonctions (l'utilisation
des parenthèses est facultative, mais recommandée)</li>
<li><p>
la fonction <a href="http://php.net/manual/en/function.printf.php"><code>printf</code></a> affiche une chaîne de caractère formatée et
retourne la longueur de la chaîne affichée
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int printf (string $format [, mixed $args [, mixed $... ]] )
</code></pre>
</div></li>
<li><p>
la fonction <a href="http://php.net/manual/en/function.sprintf.php"><code>sprintf</code></a> retourne une chaîne formatée
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>string sprintf (string $format [, mixed $args [, mixed $... ]] )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Vous devriez reconnaître ces fonctions inspirées du langage C</li>

</ul>

</aside>

</section>
<section id="slide-org3101e05">
<h4 id="org3101e05"><span class="section-number-4">1.3.14</span> Les chaînes de caractères (format)</h4>
<ul>
<li>Le format dépend du type du paramètre que l'on veut afficher
<ul>
<li><code> "%s" </code> pour une chaîne de caractères</li>
<li><code> "%d" </code> pour un entier</li>
<li><code> "%f" </code> pour un réel</li>

</ul></li>
<li>Il peut spécifier un affichage personnalisé
<ul>
<li><code> "%4d" </code> affiche un entier de 4 caractères préfixé par des espaces</li>
<li><code> "%'04d" </code> affiche un entier de 4 caractères préfixé par des <code>0</code></li>

</ul></li>
<li>Il permet de réordonner les paramètres
<ul>
<li><code> "%2$s" </code> affiche le 2<sup>e</sup> paramètre comme une chaîne de caractères</li>
<li><code> "%1$'04d" </code> affiche le 1<sup>er</sup> paramètre sous forme d'entier de
4 caractères minimum préfixé par des <code>0</code></li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Le formatage des chaînes de caractères avec un ordre des
paramètres différent est principalement utilisé pour la
traduction.</li>
<li>En français, on aurait pour afficher 'voiture bleue' :
<ul>
<li><code>$chaine = '%s %s';</code></li>
<li><code>$object = 'voiture';</code></li>
<li><code>$color = 'bleue';</code></li>

</ul></li>
<li>En anglais, on aurait pour afficher 'blue car' :
<ul>
<li><code>$chaine = '%2$s %1$s';</code></li>
<li><code>$object = 'car';</code></li>
<li><code>$color = 'blue';</code></li>

</ul></li>
<li>Avec la fonction <code>printf($chaine, $object, $color)</code></li>

</ul>

</aside>

</section>
<section id="slide-org36980e0">
<h4 id="org36980e0"><span class="section-number-4">1.3.15</span> Les chaînes de caractères (fonctions de base)</h4>
<ul>
<li><code>strlen </code> : retourne la longueur de la chaîne</li>
<li><code>strcmp </code> : compare deux chaînes</li>
<li><code>trim   </code> : supprime les espaces ou un autre caractère<br />
<code>       </code>   en début (<code>ltrim</code>) et fin de chaîne (<code>rtrim</code>)</li>
<li><code>substr </code> : retourne une sous-chaîne</li>
<li><code>strpos </code> : cherche la position d'une sous-chaîne dans une autre chaîne</li>
<li><code>nl2br  </code> : remplace <code>\n</code> en <code>&lt;br&gt;</code></li>
<li><code>ucfirst</code> : première lettre en majuscule</li>
<li><code>ucwords</code> : première lettre de chaque mot en majuscule</li>
<li>D'autres fonctions <code>str_replace</code>, <code>strtolower</code>, <code>strtoupper</code>, <code>implode</code>, <code>explode</code> sur : <a href="http://php.net/manual/en/ref.strings.php">http://php.net/manual/en/ref.strings.php</a></li>

</ul>

<aside class="notes">
<ul>
<li>Je vous invite à tester toutes ces fonctions</li>

</ul>

</aside>

</section>
<section id="slide-org173a6e7">
<h4 id="org173a6e7"><span class="section-number-4">1.3.16</span> Résumé (types simples)</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-string"><code trim>&lt;?php
  var_dump("0");
  var_dump("0" + 2);
  var_dump("0" + 1.3);
  var_dump("0" + true);
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer d'anticiper le résultat avant de l'exécuter</li>

</ul>

</aside>

</section>
<section id="slide-org5c7ad43">
<h4 id="org5c7ad43"><span class="section-number-4">1.3.17</span> Les tableaux (array)</h4>
<ul>
<li>Il faut utiliser le mot clé <code>array()</code> (<code>[]</code> autorisé depuis PHP 5.4)</li>
<li>Chaque paramètre correspond à une paire <code>clé =&gt; valeur</code></li>
<li>Une clé peut-être un entier ou une chaîne de caractères
<ul>
<li>Une chaîne correspondant à un entier valide sera transformé en entier</li>
<li>Les autres types sont convertis en entiers</li>

</ul></li>
<li>Les clés sont optionnelles.</li>

</ul>

<aside class="notes">
<ul>
<li>En pratique on utilise maintenant les crochets '[]'</li>
<li>Les tableaux sont créés dynamiquement</li>
<li>Quand la clé correspond à une chaîne de caractères on parle de
tableaux associatifs</li>

</ul>

</aside>

</section>
<section id="slide-org034f715">
<h4 id="org034f715"><span class="section-number-4">1.3.18</span> Les tableaux (fonctions de base)</h4>
<ul>
<li><code>count       </code> : retourne le nombre d'éléments contenus dans un tableau</li>
<li><code>sort        </code> : trie par rapport aux valeurs un tableau (<code>rsort</code> reverse)</li>
<li><code>asort       </code> : trie les valeurs en conservant les clés (<code>arsort</code> reverse)</li>
<li><code>ksort       </code> : trie les clés d'un tableau (<code>krsort</code> reverse)</li>
<li><code>array_keys  </code> : retourne les clés d'un tableau sous forme d'un tableau</li>
<li><code>array_values</code> : retourne les valeurs d'un tableau sous forme d'un tableau</li>
<li>D'autres fonctions <code>array_pop</code>, <code>array_shift</code>, <code>array_map</code> sur : <a href="http://php.net/manual/en/function.array.php">http://php.net/manual/en/function.array.php</a></li>

</ul>

<aside class="notes">
<ul>
<li>Je vous invite à tester toutes ces fonctions</li>

</ul>

</aside>

</section>
<section id="slide-org9e70253">
<h4 id="org9e70253"><span class="section-number-4">1.3.19</span> Les tableaux (exemple)</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-array"><code trim>&lt;?php
  var_dump(array("a","b","c"));
  var_dump(array("a" =&gt; "b", 3 =&gt; "c"));
  var_dump(array("a", 3 =&gt; "b", "c"));
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>On peut remarquer que par défaut les clés correspondent à des
index commençant par 0</li>
<li>Le deuxième tableau montre qu'il est possible d'utiliser des clés
numériques et textuelles dans le même tableau</li>
<li>Le dernier tableau montre que les index créés se basent sur le
plus grand index existant. On aurait pu penser que le 'c' soit
associé à l'index 1 ou 2.</li>

</ul>

</aside>

</section>
<section id="slide-org7eb4a49">
<h3 id="org7eb4a49"><span class="section-number-3">1.4</span> Les variables et constantes</h3>
<div class="outline-text-3" id="text-1-4">
</div>
</section>
<section id="slide-orgf809451">
<h4 id="orgf809451"><span class="section-number-4">1.4.1</span> Les variables</h4>
<ul>
<li>Une variable est désignée par le signe <code>$</code></li>
<li>Le nom est sensible à la casse et commence par une lettre ou un
tiret du bas <code>_</code> suivi de lettres, de chiffres ou <code>_</code></li>
<li><code>$this</code> est une variable spéciale qui ne peut pas être modifiée</li>
<li>Il n'est pas obligatoire de déclarer et d'initialiser les variables (recommandé)</li>
<li>Le nom d'une variable peut être dynamique</li>

</ul>

<aside class="notes">
<ul>
<li>la variable <code>$this</code> est utilisée pour la manipulation des objets
en PHP.</li>

</ul>

</aside>

</section>
<section id="slide-org1c71ecd">
<h4 id="org1c71ecd"><span class="section-number-4">1.4.2</span> Gérer le type d'une variable</h4>
<ul>
<li>La fonction <code>gettype()</code> permet d'obtenir une chaîne de caractères
correspondant au type de l'argument : <code>boolean</code>, <code>integer</code>,
<code>double</code>, <code>string</code>, <code>array</code>, <code>object</code>, <code>resource</code>, <code>NULL</code> ou
<code>unknown type</code>.</li>
<li>Les fonctions suivantes : <code>is_array()</code>, <code>is_bool()</code>,
<code>is_float()</code>, <code>is_int()</code>, <code>is_null()</code>, <code>is_numeric()</code>,
<code>is_object()</code>, <code>is_resource()</code>, <code>is_scalar()</code> (integer, float,
string and booleen), <code>is_string()</code> permettent de vérifier si un
argument est d'un type particulier.</li>
<li>Le typage est dynamique en PHP</li>

</ul>

<aside class="notes">
<ul>
<li>comme le typage est dynamique en PHP, il peut parfois être utile
de vérifier le type associé à une variable pour utiliser cette
variable sans erreur dans le code.</li>

</ul>

</aside>

</section>
<section id="slide-org683581f">
<h4 id="org683581f"><span class="section-number-4">1.4.3</span> Tester l'état d'une variable</h4>
<ul>
<li><code>empty()</code></li>
<li><code>is_null()</code></li>
<li><code>isset()</code></li>
<li><code>(bool)</code></li>
<li><a href="http://php.net/manual/en/types.comparisons.php">http://php.net/manual/en/types.comparisons.php</a></li>

</ul>

<div class="org-src-container">

<pre  class="src src-center"><code trim>  empty() !== (bool) 
is_null() !== isset()
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-center"><code trim>'php' == 0     =&gt; true 
0     == null  =&gt; true 
null  == 'php' =&gt; false
</code></pre>
</div>

<aside class="notes">
<ul>
<li>les tests <code>empty()</code> et le cast <code>(bool)</code> ainsi que <code>is_null()</code> et
<code>isset()</code> sont strictement différents, quand l'un est <code>true</code>
l'autre est <code>false</code></li>
<li>Il faut faire cependant attention avec l'égalité simple, on peut
voir que la transitivité n'est pas respectée, on aurait pu
s'attendre à ce que <code>null</code> soit égal à <code>'php'</code>. Ceci illustre les
problèmes liés à la conversion des types</li>

</ul>

</aside>

</section>
<section id="slide-org07f8df1">
<h4 id="org07f8df1"><span class="section-number-4">1.4.4</span> Les constantes</h4>
<ul>
<li>Par définition, la valeur d'une constante ne peut pas être modifiée</li>
<li>On utilise par convention, un nom écrit en lettres capitales</li>
<li>La fonction <code>define</code> est utilisée</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-define"><code trim>&lt;?php
  define('HELLO', 3); 
  $a = 'hello'; 
  $$a = 'world'; 
  var_dump(HELLO); 
  //var_dump('$a $hello HELLO'); 
  //var_dump("$a $hello $$a HELLO"); 
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer de trouver le résultat avant d'exécuter le code.</li>
<li>On peut voir la différence entre l'utilisation des guillemets
simples et doubles</li>
<li>Il n'est pas possible d'utiliser les noms dynamiques des variables
dans une chaîne de caractères d'où l'affichage <code>$hello</code> et non pas
<code>world</code></li>
<li>Les constantes ne sont pas interprêtées et la chaînes <code>HELLO</code> est
donc conservées</li>

</ul>

</aside>

</section>
<section id="slide-org26f226b">
<h3 id="org26f226b"><span class="section-number-3">1.5</span> Les opérateurs</h3>
<ul>
<li>Les opérateurs arithmétiques</li>
<li>Les opérateurs d'affectation</li>
<li>Les opérateurs de comparaison</li>
<li>Les opérateurs d'incrémentation et décrémentation</li>
<li>L'opérateur ternaire</li>
<li>Les opérateurs logiques</li>
<li>Les autres opérateurs</li>

</ul>

<aside class="notes">
<ul>
<li>Tous les opérateurs vont être présentés</li>

</ul>

</aside>

</section>
<section id="slide-org789f8c0">
<h4 id="org789f8c0"><span class="section-number-4">1.5.1</span> Les opérateurs arithmétiques</h4>
<ul>
<li><code>-$a     </code> : la négation</li>
<li><code>$a + $b </code> : l'addition</li>
<li><code>$a - $b </code> : la soustraction</li>
<li><code>$a * $b </code> : la multiplication</li>
<li><code>$a / $b </code> : la division</li>
<li><code>$a % $b </code> : le modulo</li>
<li><code>$a ** $b</code> : l'exponentielle (PHP 5.6)</li>

</ul>

<aside class="notes">
<ul>
<li>Ce sont les mêmes opérateurs que le langage C avec l'ajout de
l'exponentielle</li>

</ul>

</aside>

</section>
<section id="slide-org072336c">
<h4 id="org072336c"><span class="section-number-4">1.5.2</span> Les opérateurs d'affectation</h4>
<ul>
<li>Le signe <code> = </code></li>
<li>Il est possible de combiner le signe <code> = </code> avec d'autres opérateurs</li>
<li>Le passage par référence est possible avec <code> &amp; </code></li>
<li>L'opérateur <code> * </code> du C n'a pas de signification en PHP</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-assign"><code trim>&lt;?php
  $a = 3;
  $b = &amp;$a;
  $a += 4;
  var_dump($a); 
  var_dump($b);
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>La notion de pointeur n'est pas défini comme en C et l'opérateur
<code> &amp; </code> permet de créer un alias</li>

</ul>

</aside>

</section>
<section id="slide-orged50f9b">
<h4 id="orged50f9b"><span class="section-number-4">1.5.3</span> Les opérateurs de comparaison</h4>
<ul>
<li><code>$a == $b </code> : égalité des valeurs</li>
<li><code>$a === $b</code> : identité (égalité des valeurs et des types)</li>
<li><code>$a != $b </code> : différence</li>
<li><code>$a &lt;&gt; $b </code> : différence</li>
<li><code>$a !== $b</code> : non identité (différence des valeurs ou des types)</li>
<li><code>$a &lt; $b  </code> : infériorité</li>
<li><code>$a &gt; $b  </code> : supériorité</li>
<li><code>$a &lt;= $b </code> : infériorité ou égalité</li>
<li><code>$a &gt;= $b </code> : supériorité ou égalité</li>

</ul>

<aside class="notes">
<ul>
<li>Comme PHP n'est pas fortement typé, il faut considérer
principalement l'identité et la non identité pour comparer des
variables, ceci afin d'éviter les erreurs liées à la conversion de
types</li>

</ul>

</aside>

</section>
<section id="slide-org83bbd4c">
<h4 id="org83bbd4c"><span class="section-number-4">1.5.4</span> Les opérateurs d'incrémentation et décrémentation</h4>
<ul>
<li><code>++$a</code> : incrémente <code>$a</code>  de 1, puis retourne <code>$a</code></li>
<li><code>$a++</code> : retourne <code>$a</code> puis incrémente <code>$a</code>  de 1</li>
<li><code>--$a</code> : décrémente <code>$a</code>  de 1, puis retourne <code>$a</code></li>
<li><code>$a--</code> : retourne <code>$a</code> puis décrémente <code>$a</code>  de 1</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-incr-decr"><code trim>&lt;?php
  $a = 3;
  var_dump($a++); 
  //var_dump($a);
  //var_dump(--$a); 
  //var_dump($a); 
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer de trouver le résultat avant d'exécuter le code. Il s'agit
du même comportement que le langage C</li>

</ul>

</aside>

</section>
<section id="slide-orge482091">
<h4 id="orge482091"><span class="section-number-4">1.5.5</span> L'opérateur ternaire</h4>
<ul>
<li><code>?:</code> est un opérateur conditionnel ternaire</li>
<li><code>(expr1) ? (expr2) : (expr3)</code> est évalué à :
<ul>
<li><code>expr2</code> si <code>expr1</code> est évaluée à <code>true</code></li>
<li><code>expr3</code> si <code>expr1</code> est évaluée à <code>false</code></li>

</ul></li>
<li><code>expr2</code> n'est plus obligatoire depuis PHP 5.3</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-ternary"><code trim>&lt;?php
  var_dump('1' == 1 ? 'oui' : 'non'); 
  var_dump('1' === 1 ? 'oui' : 'non'); 
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>L'opérateur ternaire n'est utile pour simplier la lecture du code source.</li>

</ul>

</aside>

</section>
<section id="slide-orgc8f02f0">
<h4 id="orgc8f02f0"><span class="section-number-4">1.5.6</span> Les opérateurs logiques</h4>
<ul>
<li><code>$a &amp;&amp; $b </code> : <code>true</code> si <code>$a</code> et <code>$b</code> valent <code>true</code></li>
<li><code>$a and $b</code> : <code>true</code> si <code>$a</code> et <code>$b</code> valent <code>true</code></li>
<li><code>$a || $b </code> : <code>true</code> si <code>$a</code> vaut <code>true</code> ou <code>$b</code> vaut <code>true</code></li>
<li><code>$a or $b </code> : <code>true</code> si <code>$a</code> vaut <code>true</code> ou <code>$b</code> vaut <code>true</code></li>
<li><code>$a xor $b</code> : <code>true</code> si <code>$a</code> vaut <code>true</code> ou <code>$b</code> vaut <code>true</code> mais pas les 2</li>
<li><code>!$a      </code> : <code>true</code> si <code>$a</code> ne vaut pas <code>true</code></li>

</ul>

<aside class="notes">
<ul>
<li>Il s'agit ici des opérateurs logiques classiques</li>

</ul>

</aside>

</section>
<section id="slide-org2846a50">
<h4 id="org2846a50"><span class="section-number-4">1.5.7</span> Les autres opérateurs</h4>
<ul>
<li><code>.</code> correspond à l'opération de concaténation pour les chaînes de caractères</li>
<li><code>[index]</code> permet d'accéder à un élément particulier d'un tableau</li>
<li><code>[]</code> permet assigner une valeur à la fin d'un tableau</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-array-op"><code trim>&lt;?php
  $a = "hello ";
  $b = array($a);
  $b[] = "world";
  var_dump($a[4]);
  var_dump($a.$b[1]);
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer de trouver le résultat avant d'exécuter le code.</li>

</ul>

</aside>

</section>
<section id="slide-orgbaedd83">
<h3 id="orgbaedd83"><span class="section-number-3">1.6</span> Les structures de contrôle</h3>
<ul>
<li>Les structures conditionnelles</li>
<li>Les structures répétitives</li>
<li>L'inclusion de fichiers</li>

</ul>

<aside class="notes">
<ul>
<li>Tous les structures de contrôle vont être présentées</li>

</ul>

</aside>

</section>
<section id="slide-org2c5478e">
<h4 id="org2c5478e"><span class="section-number-4">1.6.1</span> Les structures conditionnelles (if, else, elseif)</h4>
<div class="org-src-container">

<pre  class="src src-c"><code trim>if (condition) {
  instructions; // si condition évaluée à true
}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-c"><code trim>if (condition) {
  instructions; // si condition évaluée à true
} else {
  instructions; // si condition évaluée à false
}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-c"><code trim>if (condition1) {
  instructions; // si condition1 évaluée à true
} elseif (condition2) {
  instructions; // si condition1 évaluée à false et condition2 évaluée à true
} else {
  instructions; // si condition1 et condition 2 évaluées à false
}
</code></pre>
</div>

<aside class="notes">
<ul>
<li><code>elseif</code> n'existe pas en C où il faut utiliser <code>else if</code></li>

</ul>

</aside>

</section>
<section id="slide-orga670973">
<h4 id="orga670973"><span class="section-number-4">1.6.2</span> Les structures conditionnelles (switch)</h4>
<div class="org-src-container">

<pre  class="src src-c"><code trim>switch ($i) {
 case 0:
   echo "i equals 0";
   break;
 case 'a':
   echo "i equals a";
   break;
 default:
   echo "aucune valeur correspondante";
}
</code></pre>
</div>

<ul>
<li>équivalent à :</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>// == pas ===
if ($i == 0) {
  echo "i equals 0";
} elseif ($i == 'a') {
  echo "i equals 1";
} else {
  echo "aucune valeur correspondante";
}
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Il faut faire attention à la conversion de types quand on utilise
un switch car la comparaison n'est pas effectuée sur le type</li>

</ul>

</aside>

</section>
<section id="slide-orge1706cc">
<h4 id="orge1706cc"><span class="section-number-4">1.6.3</span> Les structures répétitives (tant que)</h4>
<div class="org-src-container">

<pre  class="src src-c"><code trim>while (condition) {
  instructions; // tant que condition est évaluée à true
}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-c"><code trim>do {
  instructions; // tant que condition est évaluée à true
} while (condition);
</code></pre>
</div>

<aside class="notes">
<ul>
<li><code>do...while</code> est à utiliser pour exécuter l'instruction au moins
une fois</li>

</ul>

</aside>

</section>
<section id="slide-org3af60ce">
<h4 id="org3af60ce"><span class="section-number-4">1.6.4</span> Les structures répétitives (pour)</h4>
<div class="org-src-container">

<pre  class="src src-c"><code trim>for (expr1; expr2; expr3) { // expr1 est exécutée une seule fois au début de la boucle
  instructions;             // exécuté tant que expr2 est évaluée à true
                            // expr3 est exécutée à la fin de chaque itération
}
</code></pre>
</div>

<ul>
<li>équivalent à :</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>expr1;
while (expr2) {
  instructions;
  expr3;
}
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Les structures répétitives sont équivalentes, c'est à vous de
choisir celle que vous préférez</li>

</ul>

</aside>

</section>
<section id="slide-org6d4b1c3">
<h4 id="org6d4b1c3"><span class="section-number-4">1.6.5</span> Les structures répétitives (tableau)</h4>
<ul>
<li><code>foreach</code> permet de parcourir les éléments d'un tableau</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>foreach ($array as $value) {
  instructions;
}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-c"><code trim>foreach ($array as $key =&gt; $value) {
  instructions;
}
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Pour parcourir un tableau, il est conseillé d'utiliser <code>foreach</code></li>

</ul>

</aside>

</section>
<section id="slide-org27b6613">
<h4 id="org27b6613"><span class="section-number-4">1.6.6</span> Exemple général sur les structures</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-while-foreach-example"><code trim>&lt;?php
  $i = 0;
  $values = array();
  while (count($values) &lt; 10) {
    $values[] = $i++;
  }
  $output = "values :";
  foreach($values as $value) {
    if ($value % 2) {
      $output .= ' ' . $value;
    }
  }
  echo $output;
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Essayer de trouver le résultat avant d'exécuter le code.</li>

</ul>

</aside>

</section>
<section id="slide-orge37bcbc">
<h3 id="orge37bcbc"><span class="section-number-3">1.7</span> Les fonctions</h3>
<ul>
<li>sont des blocs d'instructions que l'on peut répéter dans un programme</li>
<li>ne sont pas exécutées directement après leurs définitions</li>
<li>sont exécutées par un appel</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function"><code trim>&lt;?php
  function helloWorld() {
    echo "Hello world!";
  }

  helloWorld();
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>les fonctions sont similaires aux fonctions du langage C</li>

</ul>

</aside>

</section>
<section id="slide-org28bfa74">
<h4 id="org28bfa74"><span class="section-number-4">1.7.1</span> Les arguments</h4>
<ul>
<li>Un argument est une variable, défini après le nom de la fonction entre paranthèses</li>
<li>Les arguments sont séparés par une virgule</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function-args"><code trim>&lt;?php
  function helloWorld($hello, $world) {
    echo "$hello $world!&lt;br&gt;\n";
  }

  helloWorld('Hello', 'world');
  helloWorld('Bonjour', 'tous');
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>les fonctions avec des arguments sont similaires aux fonctions du langage C</li>

</ul>

</aside>

</section>
<section id="slide-orga0fba4f">
<h4 id="orga0fba4f"><span class="section-number-4">1.7.2</span> Les valeurs par défaut</h4>
<ul>
<li>Il est possible de définir une valeur par défaut à un argument</li>
<li>Les arguments qui ont une valeur par défaut sont définis en dernier</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function-default-args"><code trim>&lt;?php
  function helloWorld($hello, $world = 'world') {
    echo "$hello $world!\n";
  }

  helloWorld('Bonjour', 'tous');
  helloWorld('Hello');
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Contrairement aux fonctions en C il est possible de définir une
valeur par défaut si aucun paramètre n'est donné à la fonction
alors la variable prendra cette valeur</li>

</ul>

</aside>

</section>
<section id="slide-orge72b419">
<h4 id="orge72b419"><span class="section-number-4">1.7.3</span> Les retours</h4>
<ul>
<li>Tous les types de variables peuvent être retournés par une fonction</li>
<li>Si <code>return</code> est absent, <code>null</code> est retourné</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function-return"><code trim>&lt;?php
  function helloWorld() {
    return "Hello world!";
  }

  var_dump(helloWorld());
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>les retours des fonctions sont similaires aux retours des
fonctions du langage C</li>

</ul>

</aside>

</section>
<section id="slide-orga9dc1fe">
<h4 id="orga9dc1fe"><span class="section-number-4">1.7.4</span> Retourner plusieurs valeurs</h4>
<ul>
<li>Il faut utiliser un tableau</li>

</ul>

<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function-return-array"><code trim>&lt;?php
  function helloWorld() {
    $result = array();

    $result[] = "Hello";
    $result[] = "world!";

    return $result;
  }

  echo implode(" ", helloWorld());
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Comme il est possible de retourner un tableau en PHP, cela permet
de renvoyer plusieurs valeurs</li>

</ul>

</aside>

</section>
<section id="slide-org4bfb169">
<h4 id="org4bfb169"><span class="section-number-4">1.7.5</span> Arguments par référence</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function-args-reference"><code trim>&lt;?php
  $hello = "Hello";
  $world = "World";
  function helloWorld($bonjour, &amp;$tous) {
    $bonjour = "Bonjour";
    $tous = "tous";
  }

  helloWorld($hello, $world);
  echo $hello." ".$world;
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Les références correspondent plus ou moins aux pointeurs en C à la
différence qu'il n'y a pas d'équivalent pour l'opérateur '*'. On
ne peut pas manipuler les adresses seulement le contenu des variables.q</li>

</ul>

</aside>

</section>
<section id="slide-orgb785652">
<h4 id="orgb785652"><span class="section-number-4">1.7.6</span> Une fonction récursive</h4>
<div class="org-src-container">

<pre  class="src src-php" id="phpjs-function-rec"><code trim>&lt;?php
  // affiche n fois la lettre 'o'
  function o($n) {
    $res = '';
    if ($n &gt; 0) {
      $res = 'o'.o($n -1);
    }
    return $res;
  }

  function helloWorld($n = 1) {
    echo 'Hell'.o($n)." world!\n";
  } 

  helloWorld();
  helloWorld(10);
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>La récursivité des fonctions fonctionne comme en langage C</li>

</ul>

</aside>

</section>
<section id="slide-orgaa808d8">
<h3 id="orgaa808d8"><span class="section-number-3">1.8</span> Les variables prédéfinies</h3>
<ul>
<li><code>$_GET    </code> : variables de la méthode GET (dans l'url)</li>
<li><code>$_POST   </code> : variables de la méthode POST (dans l'entête HTTP)</li>
<li><code>$_REQUEST</code> : contenu de <code>$_GET</code>, <code>$_POST</code> (<code>$_COOKIE</code> : PHP &lt; 5.3)</li>
<li><code>$_FILES  </code> : gestion des fichiers uploadés</li>
<li><code>$_COOKIE </code> : variables des cookies HTTP (stockées chez le client)</li>
<li><code>$_SESSION</code> : variables de session (stockées sur le serveur)</li>
<li><code>$_SERVER </code> : variables de serveur et d'exécution</li>
<li><code>$GLOBALS </code> : variables disponibles dans le contexte global (<i>à éviter</i>)</li>
<li><code>$argc    </code> : nombre d'arguments passés au script (<code>CLI</code>)</li>
<li><code>$argv    </code> : tableau avec les arguments passés au script (<code>CLI</code>)</li>

</ul>

<aside class="notes">
<ul>
<li>Nous reverrons l'utilisation de ces variables en fonction des
besoins</li>

</ul>

</aside>

</section>
<section id="slide-org687b55d">
<h3 id="org687b55d"><span class="section-number-3">1.9</span> <code>$_SERVER</code></h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>$_SERVER['DOCUMENT_ROOT']</code></td>
<td class="org-left">Racine du serveur</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['HTTP_ACCEPT_LANGUAGE']</code></td>
<td class="org-left">Langage accepté par le navigateur</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['HTTP_HOST']</code></td>
<td class="org-left">Nom de domaine du serveur</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['HTTP_USER_AGENT']</code></td>
<td class="org-left">Type de navigateur</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['PATH_INFO']</code></td>
<td class="org-left">Chemin WEB du script</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['REQUEST_URI']</code></td>
<td class="org-left">Chemin du script</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['REMOTE_ADDR']</code></td>
<td class="org-left">Adresse IP du client</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['REMOTE_PORT']</code></td>
<td class="org-left">Port de la requête HTTP</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['QUERY_STRING']</code></td>
<td class="org-left">Liste des paramètres passés au script</td>
</tr>

<tr>
<td class="org-left"><code>$_SERVER['SERVER_ADDR']</code></td>
<td class="org-left">Adresse IP du serveur</td>
</tr>
</tbody>
</table>

<aside class="notes">
<ul>
<li>Il faut faire attention à l'usage de cette variable car les
résultats ne sont pas nécessairement consistant et sont liés à la
configuration du serveur</li>

</ul>

</aside>

</section>
<section id="slide-orgb836044">
<h2 id="orgb836044"><span class="section-number-2">2</span> Les formulaires</h2>
<aside class="notes">
<ul>
<li>L'interaction avec les formulaires va montrer l'intérêt de PHP. Avec
PHP nous allons pouvoir récupérer des informations envoyées par le
client sur le serveur et interagir en conséquence.</li>
<li>Pour rappel l'attribut <code>action</code> de la balise form permet d'indiquer
la page qui va récupérer les informations du formulaire et
l'attribut <code>method</code> indiquera la façon d'envoyer les informations
(<code>GET</code> ou <code>POST</code>)</li>

</ul>

</aside>
</section>
<section id="slide-orgfd5d7d4">
<h3 id="orgfd5d7d4"><span class="section-number-3">2.1</span> GET</h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>GET form
&lt;form action="&lt;?php echo($_SERVER["PHP_SELF"]); ?&gt;" method="get"&gt;
  &lt;label&gt;input :&lt;input type="text" name="input"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;button type="submit"&gt;Valider&lt;/button&gt;
&lt;/form&gt;
</code></pre>
</div>

<p>
<a href="./examples/form.php?filename=form_get">exemple</a>
</p>

<aside class="notes">
<ul>
<li>dans cet exemple, <code>action</code> considère la page courante. Pour cela la
variable <code>$_SERVER</code> qui est un tableau peut être utilisée et l'index
<code>PHP_SELF</code> contient le nom de page courante (ce qui évite de coder
en dur le nom de la page et évite des erreurs si on décide de
renommer le fichier)</li>
<li>Attention ceci n'est pas forcément la meilleure solution, nous y
reviendrons.</li>
<li>Le formulaire contient une information textuelle avec le nom <code>input</code></li>
<li>Après avoir validé le formulaire, regardez dans l'URL de votre
navigateur, il devrait y avoir l'information suivante
<code>?input=la_valeur_que_vous_avez_entree</code></li>
<li>La méthode <code>GET</code> permet de récupérer des paramètres dans les URL. Il
ne faut donc pas l'utiliser pour des informations sensibles (mot de
passe par exemple)</li>
<li>La redirection sur la page de résultat affiche le contenu de
certaines variables PHP <code>GET</code>, <code>POST</code>, <code>REQUEST</code>, <code>FILES</code>, <code>COOKIE</code>
pour rappel <code>REQUEST</code> regroupe les valeurs passées dans <code>GET</code> et
<code>POST</code></li>
<li>Ce qu'il faut retenir c'est que <code>GET</code> permet de passer des valeurs
de formulaire dans l'URL. Le format est <code>?nom1=valeur1&amp;nom2=valeur2</code></li>

</ul>

</aside>
</section>
<section id="slide-orgd9c5525" data-background="#C8321E">
<h3 id="orgd9c5525"><span class="section-number-3">2.2</span> Sécurité</h3>
<ul>
<li>Attention à l'utilisation de <code>$_SERVER["PHP_SELF"]</code></li>
<li>Attention aux données reçues sur le serveur</li>

</ul>

<aside class="notes">
<ul>
<li>l'utilisation seule de <code>$_SERVER["PHP_SELF"]</code> n'est pas sécurisée
comme vous allez le voir dans l'exemple d'après.</li>
<li>il faut également faire attention aux données qui sont envoyées par
le <code>client</code> sur le <code>serveur</code>, elles pourraient chercher à
compromettre l'usage normal. Il faut donc toujours les vérifier
avant de les utiliser.</li>

</ul>

</aside>
</section>
<section id="slide-orged13752">
<h4 id="orged13752"><span class="section-number-4">2.2.1</span> <code>$_SERVER["PHP_SELF"]</code></h4>
<p>
<code>$_SERVER["PHP_SELF"]</code> permet de faire référence au script en cours
</p>

<ul>
<li><p>
Problème
</p>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;form action="&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;" method="post"&gt;
</code></pre>
</div>
<ul>
<li>lien normal : <a href="./examples/form.php/%22%3E%3Cscript%3Ealert('hacked')%3C/script%3E?filename=form_get">form.php</a></li>
<li>lien modifé : <a href="./examples/form.php/%22%3E%3Cscript%3Ealert('hacked')%3C/script%3E?filename=form_get">form.php/%22%3E%3Cscript%3Ealert('hacked')%3C/script%3E</a></li>

</ul></li>

<li><p>
Solution
</p>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;form action="&lt;?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?&gt;" method="post"&gt;
</code></pre>
</div>
<ul>
<li><code>htmlspecialchars($_SERVER["PHP_SELF"]);</code> ou  <code>filter_var($_SERVER['PHP_SELF'], FILTER_SANITIZE_STRING);</code></li>
<li>lien protégé : <a href="./examples/form.php/%22%3E%3Cscript%3Ealert('hacked')%3C/script%3E?filename=form_post">form.php/%22%3E%3Cscript%3Ealert('hacked')%3C/script%3E</a></li>
<li>Plus simplement pour rediriger sur la même page il est possible d'utiliser <code>action="" </code></li>

</ul></li>

<li>Remarques
<ul>
<li>Ce n'est pas grave si vous ne comprenez pas tout, retenez
seulement qu'il ne faut pas utiliser <code>$_SERVER['PHP_SELF']</code></li>

</ul></li>

</ul>
<aside class="notes">
<ul>
<li>Problème
<ul>
<li>comme <code>$_SERVER['PHP_SELF']</code> permet de représenter la page
courante, on peut ajouter des informations dans l'URL pour
modifier la valeur de la page courante</li>
<li><code>%22</code> représente <code>"</code></li>
<li><code>%3E</code> représente <code>&gt;</code></li>
<li><code>%3C</code> représente <code>&lt;</code></li>
<li><code>/%22%3E%3Cscript%3Ealert('hacked')%3C/script%3E</code> représente donc
<code>/"&gt;&lt;script&gt;alert('hacked')&lt;/script&gt;</code></li>
<li><p>
le code HTML généré par PHP avec <code>$_SERVER['PHP_SELF']</code> sera donc
</p>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;form action="/php/examples/form.php/"&gt;&lt;script&gt;alert('hacked')&lt;/script&gt;" method="post"&gt;
</code></pre>
</div>
<p>
ce qui permet par exemple d'introduire du code javascript et
correspond donc à une faille de sécurité
</p></li>

</ul></li>
<li>Solution
<ul>
<li>htmlspecialchars remplace certains caractères particuliers par l'entité HTML correspondante</li>
<li><code>"</code> par <code>&amp;quot;</code></li>
<li><code>&gt;</code> par <code>&amp;gt;</code></li>
<li><code>&lt;</code> par <code>&amp;lt;</code></li>
<li><p>
le code HTML généré par PHP avec <code>htmlspecialchars($_SERVER['PHP_SELF'])</code> sera donc
</p>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;form action="/php/examples/form.php/&amp;quot;&amp;gt;&amp;lt;script&amp;gt;alert('hacked')&amp;lt;/script&amp;gt;" method="post"&gt;
</code></pre>
</div></li>

</ul></li>
<li>Remarques
<ul>
<li>Ce n'est pas grave si vous ne comprenez pas tout, retenez
seulement qu'il ne faut pas afficher les données utilisateurs sans les vérifier</li>

</ul></li>

</ul>

</aside>
</section>
<section id="slide-org28189e7">
<h4 id="org28189e7"><span class="section-number-4">2.2.2</span> Filtrer les données des utilisateurs</h4>
<p>
Never Trust User Input
</p>

<ul>
<li>Problème

<ul>
<li>Un commentaire peut inclure du code malveillant</li>
<li>cross site scripting (XSS)</li>
<li><a href="./examples/form.php?input=&lt;script&gt;alert('hacked');&lt;/script&gt;">form.php?input=&lt;script&gt;alert('hacked');&lt;/script&gt;</a></li>

</ul></li>

<li><p>
Solution
</p>

<ul>
<li><code>htmlspecialchars()</code></li>
<li>Pas toujours suffisant si l'affichage est déjà dans une balise html</li>

</ul>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>$data = "javascript:alert('hacked');";
&lt;img src="'.htmlspecialchars($data).'"&gt;
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;img src="javascript:alert('hacked');"&gt;
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Problème
<ul>
<li>Ici on considère qu'on met comme valeur dans un formulaire du code javascript</li>
<li>Si vous affichez directement la valeur reçue, le code javascript
sera exécuté par le navigateur. C'est ce qui se passe dans le
tableau du <code>GET</code> (d'où l'alerte javascript) alors que
<code>htmlspecialchars</code> est utilisé dans le <code>REQUEST</code></li>

</ul></li>
<li>Solution
<ul>
<li><code>htmlspecialchars</code> fonctionne dans pratiquement tous les cas, mais
il faut faire attention si c'est utilisé dans un attribut html
cela ne fonctionne pas toujours</li>
<li>Ce n'est pas très important si vous ne comprenez pas cette partie,
c'est surtout pour votre culture personnelle pour le moment on ne
vous demande pas de faire des sites entièrement sécurisés</li>

</ul></li>

</ul>

</aside>
</section>
<section id="slide-org3505f19">
<h3 id="org3505f19"><span class="section-number-3">2.3</span> POST</h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>POST form
&lt;form action="&lt;?php echo htmlspecialchars($_SERVER["PHP_SELF"]); ?&gt;" method="post"&gt;
  &lt;label&gt;input :&lt;input type="text" name="input"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;button type="submit"&gt;Valider&lt;/button&gt;
&lt;/form&gt;
</code></pre>
</div>

<p>
<a href="./examples/form.php?filename=form_post">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Contrairement à l'utilisation de <code>GET</code> vous ne voyez pas la valeur
que vous avez entré dans le formulaire.</li>
<li>En fait cette valeur se trouve cachée dans l'entête HTTP. Vous vous
souvenez que la communication entre le client et le serveur se fait
par un protocole (ici HTTP ou HTTPS) et dans ce protocole, il y a
une entête qui contient des informations comme le type de navigateur
utilisé (si vous vous souvenez je vous l'avais montré en cours) et
les valeurs transmises en POST.</li>

</ul>

</aside>
</section>
<section id="slide-org9999c88">
<h3 id="org9999c88"><span class="section-number-3">2.4</span> Valeurs multiples</h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>Multiple POST form
&lt;form action="&lt;?php echo htmlspecialchars($_SERVER["PHP_SELF"]); ?&gt;" method="post"&gt;
  &lt;p&gt;
    Langues pratiquées :&lt;br /&gt;
    &lt;select name="lang[]" multiple size="4"&gt;
      &lt;option value="français"&gt; français&lt;/option&gt;
      &lt;option value="anglais"&gt; anglais&lt;/option&gt;
      &lt;option value="allemand"&gt; allemand&lt;/option&gt;
      &lt;option value="espagnol"&gt; espagnol&lt;/option&gt;
  &lt;/select&gt;
  &lt;/p&gt;
  &lt;p&gt;
    Compétences informatiques :&lt;br /&gt;
    &lt;label&gt;HTML&lt;input type="checkbox" name="input[]" value="HTML" /&gt;&lt;/label&gt;
    &lt;label&gt;PHP&lt;input type="checkbox" name="input[]" value="PHP" /&gt;&lt;/label&gt;
    &lt;label&gt;MySQL&lt;input type="checkbox" name="input[]" value="MySQL" /&gt;&lt;/label&gt;
  &lt;/p&gt;
  &lt;input type="reset" value="EFFACER"/&gt;
  &lt;input type="submit" value="ENVOI"/&gt;
&lt;/form&gt;
</code></pre>
</div>

<ul>
<li><a href="./examples/form.php?filename=form_multiple_post">exemple POST</a></li>
<li><a href="./examples/form.php?filename=form_multiple_get">exemple GET</a></li>

</ul>

<aside class="notes">
<ul>
<li>Amusez vous en testant différentes valeurs envoyées en sélectionnant
plusieurs valeurs ou pas etc. En POST vous ne verrez pas grand
chose, mais je vous invite à regarder l'URL pour voir le résultat
avec GET</li>
<li>ce qui est intéressant de noter c'est que pour envoyer plusieurs
valeurs il faut que le nom dans le formulaire HTML finisse pas <code>[]</code></li>

</ul>

</aside>
</section>
<section id="slide-org94a946a">
<h3 id="org94a946a"><span class="section-number-3">2.5</span> Buttons multiples</h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>Multiple button
&lt;form action="&lt;?php echo htmlspecialchars($_SERVER["PHP_SELF"]); ?&gt;" method="get"&gt;
    &lt;input type="submit" name="input" value="addition"&gt;
    &lt;input type="submit" name="input" value="soustraction"&gt;
    &lt;input type="submit" name="input" value="multiplication"&gt;
    &lt;input type="submit" name="input" value="division"&gt;
&lt;/form&gt;
</code></pre>
</div>

<ul>
<li><a href="./examples/form.php?filename=form_multiple_button">exemple</a></li>

</ul>

<aside class="notes">
<ul>
<li>Pour savoir quel bouton a été cliqué il est possible de lui donner une valeur.</li>

</ul>

</aside>
</section>
<section id="slide-org09533c5">
<h3 id="org09533c5"><span class="section-number-3">2.6</span> <code>$_FILES</code></h3>
<ul>
<li>Envoi de fichiers (méthode <code>POST</code>)</li>
<li>Balise form avec l'attribut <code>enctype="multipart/form-data" </code></li>
<li>Type de fichiers acceptés <code>&lt;input type="file" accept="image/jpg"&gt;</code></li>
<li>Limite de la taille du fichier envoyé :
<ul>
<li><code>upload_max_filesize</code> du fichier <code>php.ini</code></li>
<li><code>&lt;input type="hidden" name="MAX_FILE_SIZE" value="120000"&gt;</code> en octets</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Il n'est pas possible d'utiliser <code>GET</code> pour envoyer des fichiers</li>
<li>Il faut ajouter l'attribut <code>enctype</code></li>
<li>Il est possible de filtrer les fichiers proposés avec l'attribut
<code>accept</code></li>
<li>Le fichier <code>php.ini</code> est un fichier de configuration qui se situe
sur le serveur et sauf si c'est sur votre machine personnelle, vous
ne pouvez pas modifier cette valeur.</li>
<li>l'input en html n'est pas très utile car il ne permet pas d'envoyer
des fichiers plus gros que la valeur définie dans <code>php.ini</code></li>
<li>Ne vous attardez pas trop sur cette notion de taille de fichiers, ce
n'est pas très important</li>

</ul>

</aside>
</section>
<section id="slide-org9c75d8b">
<h3 id="org9c75d8b"><span class="section-number-3">2.7</span> Informations liées aux fichiers</h3>
<ul>
<li><code>name    </code> : nom du fichier client</li>
<li><code>type    </code> : MIME du fichier client</li>
<li><code>tmp_name</code> : nom temporaire du fichier transféré</li>
<li><code>error   </code> : code d'erreur associé au fichier</li>
<li><code>size    </code> : taille du fichier transféré</li>

</ul>

<aside class="notes">
<ul>
<li>Quand le fichier est envoyé au serveur, plusieurs valeurs sont
associées</li>

</ul>

</aside>
</section>
<section id="slide-orgb8339b5">
<h3 id="orgb8339b5"><span class="section-number-3">2.8</span> Codes d'erreur</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code> 0 </code></td>
<td class="org-left"><code>UPLOAD_ERR_OK</code></td>
<td class="org-left">transfert réalisé avec succès</td>
</tr>

<tr>
<td class="org-left"><code> 1 </code></td>
<td class="org-left"><code>UPLOAD_ERR_INI_SIZE</code></td>
<td class="org-left">taille du fichier trop grande (<code>php.ini</code>)</td>
</tr>

<tr>
<td class="org-left"><code> 2 </code></td>
<td class="org-left"><code>UPLOAD_ERR_FORM_SIZE</code></td>
<td class="org-left">taille du fichier trop grande (<code>MAX_FILE_SIZE</code>)</td>
</tr>

<tr>
<td class="org-left"><code> 3 </code></td>
<td class="org-left"><code>UPLOAD_ERR_PARTIAL</code></td>
<td class="org-left">fichier partiellement transféré</td>
</tr>

<tr>
<td class="org-left"><code> 4 </code></td>
<td class="org-left"><code>UPLOAD_ERR_NOFILE</code></td>
<td class="org-left">aucun fichier transféré</td>
</tr>
</tbody>
</table>

<aside class="notes">
<ul>
<li>La valeur <code>error</code> associée au fichier permet de détecter d'éventuels
problèmes liés à l'envoi du fichier</li>

</ul>

</aside>
</section>
<section id="slide-org583574e">
<h3 id="org583574e"><span class="section-number-3">2.9</span> POST et FILES</h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>POST form with file
&lt;form action="&lt;?php echo htmlspecialchars($_SERVER["PHP_SELF"]); ?&gt;"
      method="post" enctype="multipart/form-data"&gt;
  &lt;label&gt;input :&lt;input type="text" name="input"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;label&gt;file :&lt;input type="file" name="file"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;button type="submit"&gt;Valider&lt;/button&gt;
&lt;/form&gt;
</code></pre>
</div>

<p>
<a href="./examples/form.php?filename=form_post_file">exemple</a>
</p>

<div class="org-src-container">

<pre  class="src src-xml"><code trim>POST form with files
&lt;form action="&lt;?php echo htmlspecialchars($_SERVER["PHP_SELF"]); ?&gt;"
      method="post" enctype="multipart/form-data"&gt;
  &lt;label&gt;input :&lt;input type="text" name="input"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;label&gt;file[] :&lt;input type="file" name="files[]"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;label&gt;file[] :&lt;input type="file" name="files[]"/&gt;&lt;/label&gt;&lt;br&gt;
  &lt;button type="submit"&gt;Valider&lt;/button&gt;
&lt;/form&gt;
</code></pre>
</div>

<p>
<a href="./examples/form.php?filename=form_post_files">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Vous pouvez essayer d'envoyer un ou plusieurs fichiers et voir le
résultat. Je conseille de n'envoyer que des petits fichiers textuels
pour ne pas surcharger inutilement le serveur pour rien.</li>
<li>Par défaut vous voyez que le fichier est stocké sur le serveur
temporairement dans le dossier <code>tmp</code> avec un nom généré
automatiquement par PHP</li>
<li>Pour utiliser ce fichier concrètement et le garder plus longtemps il
faudra donc le déplacer dans un dossier.</li>

</ul>

</aside>
</section>
<section id="slide-orga97185d">
<h3 id="orga97185d"><span class="section-number-3">2.10</span> Déplacement des fichiers</h3>
<ul>
<li>Il faut utiliser la fonction <code>move_uploaded_file</code></li>
<li><code>move_uploaded_file($_FILES["file"]["tmp_name"], "monimage.jpg");</code>
<ul>
<li>retourne TRUE si le déplacement a réussi ou FALSE sinon</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Quand vous déplacez un fichier, il faut lui donner un nom qui vous
garantisse que cela ne posera pas de problème et il ne faut donc
surtout pas utiliser l'attribut <code>name</code> qui contient le nom donné par
le client car cela pourrait poser des problèmes (fichier existant,
tentative de corruption en donnant des noms avec des chemins absolu
comme <code>/home/login/nom_de_fichier</code>)</li>
<li>Nous ne nous intéresserons pas à ces problèmes de sécurité. Préférez
l'utilisation d'un nom que vous définirez vous même.</li>

</ul>

</aside>
</section>
<section id="slide-org19f2720">
<h3 id="org19f2720"><span class="section-number-3">2.11</span> Validation</h3>
<ul>
<li>Never Trust User Input</li>
<li>La validation html5 n'est pas suffisante</li>
<li><p>
<a href="https://php.net/manual/en/function.filter-input.php"><code>filter_input</code></a>, <a href="https://php.net/manual/en/function.filter-var.php"><code>filter_var</code></a>
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>filter_var($email, FILTER_VALIDATE_EMAIL)
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Rappelez-vous qu'il faut toujours vérifiez les valeurs envoyées par
le client pour éviter de corrompre votre site.</li>
<li>Si vous cliquez sur les liens vous verrez que les 2 fonctions sont
proches mais que <code>filter_input</code> est plus adaptée pour vérifier les
données provenant d'un formulaire.</li>

</ul>

</aside>
</section>
<section id="slide-org41b8091">
<h2 id="org41b8091"><span class="section-number-2">3</span> Cookies et sessions</h2>
<aside class="notes">
<ul>
<li>Comme vous le savez sûrement les cookies sont des petits fichiers
textuels qui ont stockés chez le client. Ces fichiers peuvent servir
à enregistrer des préférences comme nous l'avons vu en javascript
mais ils servent surtout à garder une trace de l'accès à une page
permettant à l'aide d'un code spécifique de savoir si le serveur
communique avec le même client.</li>
<li>C'est ce qui est utilisé quand vous vous connectez à un site et que
ce dernier ne vous redemande pas à chaque changement de page votre
identifiant et votre mot de passe. Le serveur donne un identifiant
unique au client qui lui permettra de savoir si c'est bien toujours
le même.</li>
<li>Pour rappel, les cookies sont envoyés dans les entêtes HTTP pendant
la communication entre le client et le serveur</li>

</ul>

</aside>
</section>
<section id="slide-org9ee18d6">
<h3 id="org9ee18d6"><span class="section-number-3">3.1</span> Les cookies</h3>
<ul>
<li>Les cookies permettent de stocker des informations côté client<br />
(Never Trust User Input)</li>
<li>L'écriture de cookie se fait avant tout envoi de contenu HTML au
client car ces données sont envoyée dans l'entête HTTP</li>

</ul>

<aside class="notes">
<ul>
<li>Comme les données viennent du client, le serveur ne doit pas les
considérer comme sûre. Si vous connaissez la valeur d'un cookie,
vous pourriez modifier votre cookie pour usurper l'identité d'une
personne connectée à un site.</li>
<li>Cela s'appelle un vol de session (il y a quelques méthodes pour
limiter les risques en stockant par exemple l'adresse IP du client
côté serveur ou des informations sur son navigateur). Il suffit de
vérifier que les informations reçues avec un cookie correspondent
toujours.</li>

</ul>

</aside>
</section>
<section id="slide-orga27f8e8">
<h3 id="orga27f8e8"><span class="section-number-3">3.2</span> setcookie</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>setcookie($name, $value, $expire, $path, $domain, $secure, $httponly);
</code></pre>
</div>
<p>
<a href="http://php.net/manual/en/function.setcookie.php">setcookie()</a>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>$name</code></td>
<td class="org-left">(<i>obligatoire</i>)</td>
<td class="org-left">nom du cookie</td>
</tr>

<tr>
<td class="org-left"><code>$value</code></td>
<td class="org-left">(<i>facultatif</i>)</td>
<td class="org-left">valeur du cookie (chaîne de caractères)</td>
</tr>

<tr>
<td class="org-left"><code>$expire</code></td>
<td class="org-left">(<i>facultatif : 0</i>)</td>
<td class="org-left">date de fin de validité du cookie</td>
</tr>

<tr>
<td class="org-left"><code>$path</code></td>
<td class="org-left">(<i>facultatif</i>)</td>
<td class="org-left">chemin pour limiter l'accès au cookie</td>
</tr>

<tr>
<td class="org-left"><code>$domain</code></td>
<td class="org-left">(<i>facultatif</i>)</td>
<td class="org-left">domaine pour limiter l'accès au cookie</td>
</tr>

<tr>
<td class="org-left"><code>$secure</code></td>
<td class="org-left">(<i>facultatif : false</i>)</td>
<td class="org-left">HTTPS pour transmettre les cookies</td>
</tr>

<tr>
<td class="org-left"><code>$httponly</code></td>
<td class="org-left">(<i>facultatif : false</i>)</td>
<td class="org-left">utilisation uniquement du protocole HTTP</td>
</tr>
</tbody>
</table>

<aside class="notes">
<ul>
<li>Les cookies peuvent avoir une durée de vie : 0 pour dire que le
cookie expire à la fin de la session quand le navigateur ferme la
page</li>

</ul>

</aside>
</section>
<section id="slide-org83b48f5">
<h3 id="org83b48f5"><span class="section-number-3">3.3</span> Affectation des cookies en PHP</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>setcookie('hello','world');
setcookie('couleur', 'red', time()+86400, '/mon-compte/', www.monsite.com, TRUE);

setcookie('tableau[index1]','val1');
setcookie('tableau[index2]','val2');
setcookie('tableau[index3]','val3');
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Les cookies peuvent être utilisés pour stocker des valeurs simples ou des tableaux</li>

</ul>

</aside>
</section>
<section id="slide-org5e193d8">
<h3 id="org5e193d8"><span class="section-number-3">3.4</span> Lecture des cookies</h3>
<ul>
<li><code>$_COOKIE</code> est utilisé pour récupérer les valeurs</li>
<li>Attention, il n'est pas possible de lire une valeur associée
après un appel de setcookie, il faut qu'une requête ait lieu
entre le client et le serveur.</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>setcookie('hello','world');

setcookie('tableau[index1]','val1');
setcookie('tableau[index2]','val2');
setcookie('tableau[index3]','val3');
</code></pre>
</div>

<p>
(Lisez bien les notes avant de cliquer sur ce lien d'exemple)
</p>

<p>
<a href="./examples/cookie.php">exemple</a> 
</p>

<aside class="notes">
<ul>
<li>Première fois
<ul>
<li>quand vous cliquez sur le lien, la requête HTTP est envoyée au serveur et il n'y a pas de cookie de défini</li>
<li>les appels de <code>setcookie</code> demande à PHP d'envoyer des cookies dans l'entête HTTP de la réponse</li>
<li>PHP affiche les valeurs de <code>$_COOKIE</code> mais il n'y a rien car pas de cookie dans l'entête HTTP de la requête</li>
<li>par contre côté client les cookies ont été définis (le résultat de la page affiche le contenu de <code>$_COOKIE</code>)</li>
<li>pour voir les cookies côté client vous pouvez cliquer sur le lien
« edit » qui affichera en javascript les cookies</li>

</ul></li>
<li>Deuxième fois
<ul>
<li>Si vous réactualisez la page, la requêtte HTTP contient les cookies définis avant par PHP</li>
<li>Dans le tableau, il y a donc les valeurs précédemment fixées.</li>

</ul></li>
<li>Vous pouvez éditer/créer des valeurs et voir comment ça se passe
quand vous actualisez la page. Quand vous modifiez côté client, les
valeurs PHP s'affichent directement, par contre comme PHP redéfinit
toujours <code>hello</code> et <code>tableau</code> il faut réactualiser une seconde fois
pour voir la mise à jour dans le rendu généré par PHP</li>

</ul>

</aside>
</section>
<section id="slide-orgdb52347">
<h3 id="orgdb52347"><span class="section-number-3">3.5</span> Les sessions</h3>
<ul>
<li>Les sessions permettent de stocker des informations côté serveur</li>
<li>Les sessions ne sont pas partagées entre les visiteurs</li>

</ul>

<aside class="notes">
<ul>
<li>Vous l'aurez compris, les sessions seront gérées à l'aide des cookies</li>

</ul>

</aside>
</section>
<section id="slide-org9436837">
<h3 id="org9436837"><span class="section-number-3">3.6</span> Différentes étapes</h3>
<ul>
<li>Ouverture d'une session avec <code>session_start()</code></li>
<li>Transmission d'un identifiant de session</li>
<li>Utilisation de la variable <code>$_SESSION</code></li>
<li>Fermeture de la session</li>

</ul>

<aside class="notes">
<ul>
<li><code>session_start()</code> doit être appelé en tout début de code pour que la
mise en place des éventuels cookies se fasse avant tout affichage de
code HTML</li>

</ul>

</aside>
</section>
<section id="slide-org2fdd811">
<h3 id="org2fdd811"><span class="section-number-3">3.7</span> Transmission de l'identifiant de session</h3>
<ul>
<li>Dans l'URL à l'aide de la variable <code>SID</code> (Pas recommandé)</li>
<li>Avec les cookies (il faut que le client accepte les cookies)
<ul>
<li><code>ini_set('session.use_cookies', 1);</code></li>
<li><code>ini_set('session.use_only_cookies', 1);</code> par défaut depuis PHP 5.3</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Les sessions peuvent également être utilisées avec une valeur dans
l'URL comme les valeurs <code>$_GET</code>. Ceci n'est bien sûr pas recommandé
car le partage d'une URL suffirait presque pour effectuer un vol de session.</li>
<li>Par défaut, maintenant PHP n'autorise plus que l'utilisation de
cookies et c'est uniquement comme cela que nous allons gérer les
sessions</li>

</ul>

</aside>
</section>
<section id="slide-org086976b">
<h3 id="org086976b"><span class="section-number-3">3.8</span> Utilisation des sessions - 1 - <code>session_login.php</code></h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
session_start();
if(isset($_POST["login"]) &amp;&amp; isset($_POST["pass"])) {
    if($_POST["login"]=="login" &amp;&amp; $_POST["pass"]=="pass") {
        session_regenerate_id(true);
        $_SESSION["acces"] = true;
        $_SESSION["nom"] = $_POST["login"];
    }
} else {
    if (isset($_GET["logout"])) {
        session_unset();
        session_destroy();
        header("Location:session.php");
    }
}
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>dans cette page on dit que nous allons utiliser les sessions</li>
<li>on teste si des valeurs <code>login</code> et <code>pass</code> n'ont pas été envoyées à
l'aide d'un formulaire en POST</li>
<li>si c'est le cas on vérifie que les identifiants sont corrects, les
valeurs attendues étant également <code>login</code> et <code>pass</code> (ceci n'est pas
très sécurisé, j'espère que vous l'aurez remarqué)</li>
<li>si c'est bon alors on demande à redéfinir l'identifiant de la
session pour être sûre qu'une nouvelle valeur est utilisée</li>
<li>On stocker côté serveur avec <code>$_SESSION</code> la valeur de <code>acces</code> pour
dire que la personne est connectée et on stocker son <code>nom</code> ici il
n'y a pas grand intérêt seule la personne <code>login</code> pourra se
connecter</li>
<li>sinon on regarde si dans l'URL il y a la clé <code>logout</code> auquel cas on
supprime la session et toutes ses valeurs associées puis on redirige
la personne sur la page <code>session.php</code> (header permet également
d'envoyer des informations dans l'entête HTTP et <code>Location</code> permet
de demander au navigateur d'effectuer une redirection)</li>

</ul>

</aside>
</section>
<section id="slide-org5dc8b38">
<h3 id="org5dc8b38"><span class="section-number-3">3.9</span> Utilisation des sessions - 2 - <code>session_form.php</code></h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;form method="post" action=""&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;Accès réservé aux personnes autorisées: Identifiez vous !
    &lt;/legend&gt;
    Login : &lt;input type="text" name="login"&gt;
    Pass : &lt;input type="password" name="pass" /&gt;
    &lt;input type="submit" name="envoi" value="Entrer"/&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Ici on définit simplement un formulaire de connexion en <code>post</code> sur la</li>

</ul>
<p>
page courante <code>action</code> vide
</p>
<ul>
<li>On a bien défini les valeurs pour <code>login</code> et <code>pass</code></li>

</ul>

</aside>
</section>
<section id="slide-orge64453f">
<h3 id="orge64453f"><span class="section-number-3">3.10</span> Utilisation des sessions - 3 - <code>session_menu.php</code></h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;p&gt; Visiter les pages du site &lt;br /&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="session.php"&gt;Page d'accueil&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;a href="session_public.php"&gt;Page publique&lt;/a&gt;
    &lt;?php if(isset($_SESSION["public"])) echo " vue ". $_SESSION["public"]. " fois"; ?&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;a href="session_protected.php"&gt;Page protégée &lt;/a&gt;
    &lt;?php if(isset($_SESSION["protected"])) echo " vue ". $_SESSION["protected"]." fois"; ?&gt;
  &lt;/li&gt;
  &lt;?php if (isset($_SESSION["acces"])) { ?&gt;
  &lt;li&gt;&lt;a href="session.php?logout"&gt;Logout&lt;/a&gt;&lt;/li&gt;
  &lt;?php } ?&gt;
&lt;/ul&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Cette page affiche un menu avec différents liens
<ul>
<li>page d'accueil</li>
<li>page publique qui sera accessible par tout le monde</li>
<li>page protégée qui nécessite la connexion avec le formulaire</li>

</ul></li>
<li>On voit qu'on affiche les valeurs stockées dans <code>$_SESSION</code> pour
<code>public</code> et <code>protected</code></li>
<li>On n'affiche le lien de déconnexion que si la valeur <code>acces</code> est
définie</li>

</ul>

</aside>
</section>
<section id="slide-org7e990f3">
<h3 id="org7e990f3"><span class="section-number-3">3.11</span> Utilisation des sessions - 4 - <code>session_info.php</code></h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;p&gt;
&lt;?php
  echo "Nom de la session : ", session_name(),"&lt;br&gt;\n";
  echo "Id de la session : ", session_id(),"&lt;br&gt;\n";
?&gt;
&lt;/p&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>on affiche juste des informations sur la session en cours</li>

</ul>

</aside>
</section>
<section id="slide-org530f79f">
<h3 id="org530f79f"><span class="section-number-3">3.12</span> Utilisation des sessions - 5 - <code>session_public.php</code></h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;?php
session_start();
$_SESSION["public"] ++;
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;La page publique&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;
      &lt;a href="session.php"&gt;Page d'accueil&lt;/a&gt;&lt;br&gt;
      &lt;?php echo "Page publique vue ". $_SESSION["public"]. " fois"; ?&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Sur la page publique on démarre la session et on incrémente la variable de session <code>public</code></li>
<li>On affiche un lien de retour et le nombre de fois que la page publique a été vue</li>

</ul>

</aside>
</section>
<section id="slide-org5a586d5">
<h3 id="org5a586d5"><span class="section-number-3">3.13</span> Utilisation des sessions - 6 - <code>session_protected.php</code></h3>
<div class="org-src-container">

<pre  class="src src-xml"><code trim>&lt;?php
session_start();
if(!isset($_SESSION["acces"])) {
    header("Location:session.php");
} else {
    $_SESSION["protected"] ++;
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;La page protégée&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;
      &lt;a href="session.php"&gt;Page d'accueil&lt;/a&gt;&lt;br&gt;
      &lt;?php echo "Page protégée vue ". $_SESSION["protected"]. " fois"; ?&gt;&lt;br&gt;
      &lt;?php echo "&lt;h4&gt;Bonjour ". $_SESSION["nom"]."&lt;/h4&gt;"; ?&gt;
      &lt;a href="session.php?logout"&gt;Logout&lt;/a&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
</div>

<p>
<a href="./examples/session.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Sur la page protégée on vérifie <code>acces</code> pour savoir si on est
connecté et on redirige sur la page d'accueil si ce n'est pas le cas</li>
<li>sinon on incrémente la variable de session <code>protected</code> et on affiche
quelques informations réservées aux personnes connectées</li>
<li>parcourez ce petit site qui illustre l'utilisation des sessions</li>
<li>essayez de le parcourir, connectez-vous, vérifier que les valeurs de
session sont conservées si par exemple la page publique avait été
visitée.</li>
<li>quand vous vous connectez, le numéro d'id de session change mais les
valeurs associées à la session sont conservées</li>
<li>mais l'id ne change pas si on se déconnecte</li>

</ul>

</aside>

</section>
<section id="slide-org87cdd1d">
<h2 id="org87cdd1d"><span class="section-number-2">4</span> PHP et les fichiers</h2>
<aside class="notes">
<ul>
<li>Avec PHP, comme en langage C, il est possible d'utiliser des
fonctions définies dans un fichier extérieur mais également de gérer
et manipuler des fichiers pour stocker ou lire des informations
(pour remplacer l'utilisation d'une base de données type MySQL)</li>

</ul>

</aside>
</section>
<section id="slide-orgaba6377">
<h3 id="orgaba6377"><span class="section-number-3">4.1</span> L'inclusion de fichiers</h3>
<ul>
<li>Il est possible d'utiliser du code PHP ou HTML provenant d'autres fichiers :
<ul>
<li><code>include('fichier.ext');</code></li>
<li><code>require('fichier.ext');</code></li>
<li><code>include_once('fichier.ext');</code></li>
<li><code>require_once('fichier.ext');</code></li>

</ul></li>
<li>L'interpréteur PHP remplace ces lignes par le contenu du fichier</li>

</ul>

<aside class="notes">
<ul>
<li>Vous reconnaîtrez l'usage de <code>include</code> en langage C. Des détails
sont données sur la diapositive suivante</li>

</ul>

</aside>
</section>
<section id="slide-orge4c11c9">
<h3 id="orge4c11c9"><span class="section-number-3">4.2</span> L'inclusion de fichiers</h3>
<ul>
<li>La différence entre <code>include</code> et <code>require</code> concerne la gestion des erreurs
<ul>
<li><code>include</code> génère un avertissement</li>
<li><code>require</code> génère une erreur fatale</li>

</ul></li>
<li>Le suffixe <code>_once</code> permet de ne remplacer qu'une seule fois le code</li>
<li>L'extension généralement utilisée est <code>.php</code> pour protéger le contenu</li>
<li>Permet d'extraire les fonctions d'usage</li>
<li>Améliore la modularité du code</li>

</ul>

<aside class="notes">
<ul>
<li>Vous l'aurez remarqué mais il n'est pas possible de voir le code
source PHP du coté du client. Côté client, nous ne voyons que
l'interprétation du code PHP du serveur.</li>
<li>Il faut toujours privilégier le code modulaire pour éviter la
duplication de code, c'est le principe DRY (Don't Reapeat Yourself)</li>

</ul>

</aside>
</section>
<section id="slide-orgc70bb88">
<h3 id="orgc70bb88"><span class="section-number-3">4.3</span> Manipulation simple des fichiers</h3>
<ul>
<li><code>file_exists()</code> permet de vérifier l'existence d'un fichier</li>
<li><code>file_get_contents()</code> permet de lire le contenu d'un fichier</li>
<li><code>file_put_contents()</code> permet d'écrire dans un fichier</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  $file = "file.txt";
  $content = "";

  if (file_exists($file)) {
    $content = file_get_contents($file);
  }

  $content .= "Hello world\n";

  file_put_contents($file, $content);
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Si vous copiez/collez ce code dans un fichier <code>file.php</code>, vous
pouvez tester directement dans un terminal en faisant <code>php file.php</code></li>
<li>le fichier <code>file.txt</code> sera créé ou modifié. Si cela ne fonctionne
pas pensez à vérifier les droits associés au dossier (droit en
écriture)</li>

</ul>

</aside>
</section>
<section id="slide-org428e95e">
<h3 id="org428e95e"><span class="section-number-3">4.4</span> Manipulation simple des fichiers</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.readfile.php">readfile</a> lit et affiche le contenu d'un fichier 
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int readfile ( string $filename )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.file.php">file</a> lit et retourne sous forme de tableau un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>array file ( string $filename )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li><code>readfile</code> est principalement utilisé pour afficher des fichiers
binaires (image, pdf, etc.) à l'aide de PHP, nous ne l'utiliserons
pas dans ce cours</li>
<li><code>file</code> peut être utile pour lire le contenu d'un fichier ligne par
ligne</li>

</ul>

</aside>
</section>
<section id="slide-orgbc796c5">
<h3 id="orgbc796c5"><span class="section-number-3">4.5</span> Manipulation avancée des fichiers</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.fopen.php">fopen</a> ouvre un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>resource fopen ( string $filename , string $mode)
</code></pre>
</div></li>
<li><code>$mode</code> :
<ul>
<li><code> 'r'  </code> : lecture seule</li>
<li><code> 'r+' </code> : lecture et écriture</li>
<li><code> 'w'  </code> : écriture seule (création du fichier si inexistant)</li>
<li><code> 'w+' </code> : lecture et écriture (création du fichier si inexistant)</li>
<li><code> 'a'  </code> : écriture seule comme <code>w</code> (écriture en fin de fichier)</li>
<li><code> 'a+' </code> : écriture et lecture comme <code>w+</code> (écriture en fin de fichier)</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Vous retrouvez le même usage qu'en langage C. La <code>resource</code>
récupérée permet ensuite de parcourir ce fichier avec les fonctions
présentées sur la diapositive suivante</li>

</ul>

</aside>
</section>
<section id="slide-orgfe3a04f">
<h3 id="orgfe3a04f"><span class="section-number-3">4.6</span> Déplacement</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.fseek.php">fseek</a> déplace le pointeur à une position donnée
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int fseek ( resource $handle , int $offset )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.rewind.php">rewind</a>  remet le pointeur au début
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool rewind ( resource $handle )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.ftell.php">ftell</a> retourne la position du pointeur
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int ftell ( resource $handle )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.feof.php">feof</a> test la fin du fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool feof ( resource $handle )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Vous retrouvez également les fonctions basées sur le langage C. En
pratique à part <code>feof</code> qui peut être utile nous n'utiliserons pas
les autres fonctions. Elles sont utiles pour des manipulations
avancées de fichiers</li>
<li><code>feof</code> correspond à <b>file end of file</b></li>

</ul>

</aside>
</section>
<section id="slide-org6dd6bb7">
<h3 id="org6dd6bb7"><span class="section-number-3">4.7</span> Lecture</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.fread.php">fread</a> lecture du fichier en mode binaire
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>string fread ( resource $handle , int $length )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.fgets.php">fgets</a> lecture de la ligne courante
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>string fgets ( resource $handle [, int $length ] )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.fgetc.php">fgetc</a> lecture du caractère courant
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>string fgetc ( resource $handle )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Pour rappel en langage C, <code>fgets</code> retourne un <code>char*</code> et <code>fgetc</code> un
<code>int</code>, en PHP ces 2 fonctions retournent un <code>string</code>, il n'y a pas
de type spécifique en PHP pour représenter un caractère.</li>

</ul>

</aside>
</section>
<section id="slide-org32cbce5">
<h3 id="org32cbce5"><span class="section-number-3">4.8</span> Écriture/Fermeture d'un fichier</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.fwrite.php">fwrite</a>/fputs écriture du fichier en mode binaire
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int fwrite ( resource $handle , string $string [, int $length ] )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.fclose.php">fclose</a> fermeture du fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool fclose ( resource $handle )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Un résumé sur l'utilisation de ces fonctions sera présenté sur la
diapositive suivante</li>

</ul>

</aside>
</section>
<section id="slide-orgb5c9427">
<h3 id="orgb5c9427"><span class="section-number-3">4.9</span> Exemple</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
// Équivalent de file_get_contents
$file = "file.txt";
$handle = fopen($filename, "r");
if ($handle) {
  $content = fread($handle, filesize($file));
  fclose($handle);
}
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Comparaison entre l'utilisation de <code>fopen</code>, <code>fread</code>, <code>fclose</code> et
<code>file_get_contents</code></li>
<li><code>filesize</code> permet de récupérer la taille du fichier</li>

</ul>

</aside>
</section>
<section id="slide-org8543b39">
<h3 id="org8543b39"><span class="section-number-3">4.10</span> Résumé</h3>

<div class="figure">
<p><a href="http://www.luc-damas.fr/humeurs/pedagogie-houblonnee-les-fichiers/"><img src="./inc/img/pedagogie-houblonnee-fichiers.jpg" alt="pedagogie-houblonnee-fichiers.jpg" /></a>
</p>
</div>

<aside class="notes">
<ul>
<li>Comparaison entre l'utilisation de <code>fopen</code>, <code>feof</code>, <code>fread</code>,
<code>fclose</code> et <code>file_get_contents</code></li>

</ul>

</aside>
</section>
<section id="slide-org39abc37">
<h3 id="org39abc37"><span class="section-number-3">4.11</span> Vérrouillage d'un fichier</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.flock.php">flock</a> vérrouille un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool flock ( resource $handle , int $operation )
</code></pre>
</div></li>
<li><code>$operation</code> :
<ul>
<li><code>LOCK_SH</code> bloque l'écriture du fichier mais laisse le libre accès en lecture à tous les utilisateurs</li>
<li><code>LOCK_EX</code> bloque l'écriture et la lecture du fichier</li>
<li><code>LOCK_UN</code> libère le verrou installé précédemment (ne pas oublier cette fonction à la fin des opérations de lecture et écriture)</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>flock aussi s'inspire du langage C mais nous n'aurons pas à l'utiliser.</li>
<li>le problème étant que ceci ne fonctionne que pour un processus PHP
donné et que l'accès en parallèle sur un site génère plusieurs
processus et empêche donc l'utilisation correcte de <code>flock</code></li>

</ul>

</aside>
</section>
<section id="slide-orgd77c4ba">
<h3 id="orgd77c4ba"><span class="section-number-3">4.12</span> csv</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.fgetcsv.php">fgetcsv</a> retourne sous forme de tableau un fichier CSV
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>array fgetcsv ( resource $handle 
                [, int $length = 0
                [, string $delimiter = ","
                [, string $enclosure = '"'
                [, string $escape = "\\" ]]]] )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.fputcsv.php">fputcsv</a> écrit une ligne CSV dans un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int fputcsv ( resource $handle ,
              array $fields
              [, string $delimiter = ","
              [, string $enclosure = '"' ]] )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>L'utilisation de fichier csv permet de stocker des informations dans
des fichiers sans utiliser de base de données du type MySQL</li>

</ul>

</aside>
</section>
<section id="slide-orgeacea12">
<h3 id="orgeacea12"><span class="section-number-3">4.13</span> Action sur les fichiers</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.copy.php">copy</a> copie un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool copy ( string $source , string $dest )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.rename.php">rename</a> renomme unfichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool rename ( string $oldname , string $newname )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.unlink.php">unlink</a> supprime un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>bool unlink ( string $filename )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Les opérations de base pour copier/renommer/supprimer un fichier. Il
faut faire attention en utilisant ces fonctions les opérations sont
irréversibles.</li>

</ul>

</aside>
</section>
<section id="slide-orgdfcbe30">
<h3 id="orgdfcbe30"><span class="section-number-3">4.14</span> Information sur les fichiers</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/function.filesize.php">filesize</a> récupère la taille du fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int filesize ( string $filename )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.fileatime.php">fileatime</a> donne la date du dernier accès à un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int fileatime ( string $filename )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.filemtime.php">filemtime</a> donne la date de dernière modification d'un fichier
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>int filemtime ( string $filename )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.realpath.php">realpath</a> retourne le chemin absolu d'un chemin
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>string realpath ( string $path )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/function.basename.php">basename</a> retourne le nom du fichier d'un chemin
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>string basename ( string $path [, string $suffix ] )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Quelques fonctions de base pour récupérer des informations sur les
fichiers</li>

</ul>

</aside>
</section>
<section id="slide-org4a83edb">
<h2 id="org4a83edb"><span class="section-number-2">5</span> Bases de données SQL</h2>
<aside class="notes">
<ul>
<li>Pour stocker des informations efficacement, on utilise la plupart du
temps des bases de données relationnelles comme MySQL, SQLite, etc.</li>

</ul>

</aside>
</section>
<section id="slide-orgfc580c8">
<h3 id="orgfc580c8"><span class="section-number-3">5.1</span> Approches</h3>
<ul>
<li>Approche spécifique
<ul>
<li>MySQL : <a href="http://php.net/manual/en/book.mysqli.php">mysqli</a> (<a href="http://php.net/manual/en/ref.mysql.php">mysql</a> obsolète depuis PHP 5.5)</li>
<li>SQLite : <a href="http://php.net/manual/en/book.sqlite3.php">sqlite3</a></li>
<li>PostgreSQL : <a href="http://php.net/manual/en/book.pgsql.php">pgsql</a></li>

</ul></li>
<li>Approche générale
<ul>
<li>PHP Data Objects : <a href="http://php.net/manual/en/book.pdo.php">PDO</a></li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Il existe 2 approches pour utiliser des bases de données.</li>
<li>MySQL/PostgreSQL nécessitent un serveur spécifique</li>
<li>SQLite utilise un fichier pour stocker la base (ceci facilite
grandement son utilisation)</li>

</ul>

</aside>
</section>
<section id="slide-org43153ed">
<h3 id="org43153ed"><span class="section-number-3">5.2</span> Approche spécifique</h3>
<ul>
<li>Avantages :
<ul>
<li>Permet d'utiliser les spécificités/fonctionnalités avancées de la base</li>
<li>Possède généralement de meilleures performances</li>

</ul></li>
<li>Inconvénient :
<ul>
<li>Contraint la base de données avec un code spécifique</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Cette approche n'est à considérer que si vous avez des contraintes
fortes ou pour des usages très spécifiques. Nous ne l'utiliserons
pas.</li>

</ul>

</aside>
</section>
<section id="slide-org5f63f25">
<h3 id="org5f63f25"><span class="section-number-3">5.3</span> Approche générale</h3>
<ul>
<li>Avantages :
<ul>
<li>Code générique pour utiliser différents moteurs de bases de données</li>

</ul></li>
<li>Inconvénient :
<ul>
<li>Généricité à nuancer (<code>AUTOINCREMENT</code>, <code>AUTO_INCREMENT</code>)</li>
<li>Limité aux fonctionnalités de base</li>

</ul></li>

</ul>

<aside class="notes">
<ul>
<li>Cette approche est maintenant la plus utilisée</li>
<li>Elle simplifie grandement la maintenabilité du code</li>
<li>Nous l'utiliserons dans ce cours avec SQLite</li>

</ul>

</aside>
</section>
<section id="slide-org7d0a604">
<h3 id="org7d0a604"><span class="section-number-3">5.4</span> Exemple</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  // mysqli
  $mysqli = new mysqli('example.com', 'user', 'password', 'database');
  $result = $mysqli-&gt;query("SELECT 'Bonjour, cher utilisateur de MySQL !' AS _message FROM DUAL");
  $row = $result-&gt;fetch_assoc();
  echo htmlentities($row['_message']);

  // PDO
  $pdo = new PDO('mysql:host=example.com;dbname=database', 'user', 'password');
  $statement = $pdo-&gt;query("SELECT 'Bonjour, cher utilisateur de MySQL !' AS _message FROM DUAL");
  $row = $statement-&gt;fetch(PDO::FETCH_ASSOC);
  echo htmlentities($row['_message']);
?&gt;
</code></pre>
</div>

<p>
<a href="http://php.net/manual/fr/mysqlinfo.api.choosing.php">http://php.net/manual/fr/mysqlinfo.api.choosing.php</a>
</p>

<aside class="notes">
<ul>
<li>Cet exemple montre l'utilisation d'une connexion à un serveur MySQL</li>
<li>Si nous changeons de base de données (par exemple avec SQLite), il
faudra changer tout le code associé à <code>mysqli</code> alors qu'il suffira
de changer seulement la ligne de création de l'objet PDO. Le reste
du code ne changera pas.</li>

</ul>

</aside>
</section>
<section id="slide-orgcff6612">
<h3 id="orgcff6612"><span class="section-number-3">5.5</span> PDO : créer une connexion</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  ini_set("display_errors", "1");
  error_reporting(E_ALL);
  $pdo = new PDO("mysql:host=localhost;dbname=database", "user", "password");
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_exception.php">exemple</a>
</p>

<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  ini_set("display_errors", "1");
  error_reporting(E_ALL);
  try {
    $pdo = new PDO("mysql:host=localhost;dbname=database", "user", "password");
  } catch(PDOException $e) {
    echo $e-&gt;getMessage();
  }
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_try.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Il faut faire attention dans la gestion des erreurs car si
vous n'entourez pas le code de création de l'objet PDO avec un <code>try</code>
<code>catch</code>, des informations sensibles peuvent apparaître comme dans le
premier exemple où l'on voit le mot de passe.</li>
<li>le <code>try</code>, <code>catch</code> permet de vérifier que le code compris dans les
accolades associées au <code>try</code> ne génère pas d'exception. Si cela se
produit, le code est arrêté et fait appel au code associé au <code>catch</code></li>

</ul>

</aside>
</section>
<section id="slide-org869af1f">
<h3 id="org869af1f"><span class="section-number-3">5.6</span> PDO : fermer une connexion</h3>
<ul>
<li>Fermeture automatique à la fin du script</li>
<li>Mettre à null la variable qui gère la connexion</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  try {
    // ouverture de la base de données
    $pdo = new PDO("sqlite::memory:");

    echo "Connecté à la base de données";

    // fermeture de la base de données
    $pdo = null;
  } catch(PDOException $e) {
    echo $e-&gt;getMessage();
  }
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>SQLite utilise des fichiers pour stocker la base de données mais
possède également un mode <code>memory</code> qui permet de ne stocker la base
que temporairement en mémoire. Ceci nous sera très utile pour
présenter le cours car tout le monde travaillera avec sa propre base
de données. Cela évite d'avoir des conflits si nous travaillions
avec une base commune.</li>

</ul>

</aside>
</section>
<section id="slide-orgdc0ffc4">
<h3 id="orgdc0ffc4"><span class="section-number-3">5.7</span> PDO : exec et query</h3>
<ul>
<li><p>
<a href="http://php.net/manual/en/pdo.exec.php">exec</a> execute une requête SQL et retourne le nombre de lignes affectées
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>public int PDO::exec ( string $statement )
</code></pre>
</div></li>
<li><p>
<a href="http://php.net/manual/en/pdo.query.php">query</a> execute une requête SQL et retourne un objet <a href="http://php.net/manual/fr/class.pdostatement.php">PDOStatement</a>
</p>
<div class="org-src-container">

<pre  class="src src-c"><code trim>public PDOStatement PDO::query ( string $statement )
</code></pre>
</div></li>

</ul>

<aside class="notes">
<ul>
<li>Il existe 2 méthodes principales pour exécuter une requête, <code>exec</code>
ou <code>query</code>.</li>
<li><code>exec</code> s'utilise principalement pour des requêtes qui n'attendent
pas de résultats particuliers comme <code>CREATE</code>, <code>INSERT</code>, etc.</li>
<li><code>query</code> s'utilise principalement pour récupérer des résultats après
une requête <code>SELECT</code></li>

</ul>

</aside>
</section>
<section id="slide-orge20c2e3">
<h3 id="orge20c2e3"><span class="section-number-3">5.8</span> PDO : gestion des erreurs</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  ini_set("display_errors", "1");
  error_reporting(E_ALL);
  $error = isset($_GET["error"])?$_GET["error"]:"default";
  try {
    $pdo = new PDO("sqlite::memory:");
    switch($error) {
    case "exception":
      $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      break;
    case "warning":
      $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING);
      break;
    case "silent":
      $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_SILENT);
      break;
    }

    var_dump($pdo-&gt;exec("Hello world"));
    echo "&lt;br&gt;Code erreur : ".$pdo-&gt;errorCode()."&lt;br&gt;";

    $pdo = null;
  } catch(PDOException $e) {
    echo $e-&gt;getMessage();
  }
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_error.php">exemple</a>
</p>

<aside class="notes">
<p>
Pour voir le comportement, ajouter un paramètre (<code>GET</code>) <code>error</code> dans
l'URL en changeant les valeurs <code>exception</code>, <code>warning</code> et <code>silent</code>
</p>

</aside>
</section>
<section id="slide-orgccd1658">
<h3 id="orgccd1658"><span class="section-number-3">5.9</span> PDO : création : <code>pdo_create.php</code></h3>
<ul>
<li>Pose le plus de problème pour la généricité du code car très
spécifique à la base utilisée</li>

</ul>

<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  error_reporting(E_ALL);
  ini_set("display_errors", "1");
  try {
    $pdo = new PDO("sqlite::memory:");
    $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $table = "CREATE TABLE animals (
      animal_id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
      animal_type VARCHAR(25) NOT NULL,
      animal_name VARCHAR(25) NOT NULL 
    )";
    $pdo-&gt;exec($table);
  } catch(PDOException $e) {
    echo $e-&gt;getMessage();
  }
?&gt;
</code></pre>
</div>

<aside class="notes">
<ul>
<li>Les requêtes de création de table sont les moins génériques car tous</li>

</ul>
<p>
les systèmes de gestion de bases de données n'utilisent pas forcément
les mêmes types (différences entre <code>INT</code> SQL et <code>INTEGER</code> SQLite,
etc.) et les mêmes notations (<code>AUTO_INCREMENT</code> SQL et <code>AUTOINCREMENT</code>
SQLite)
</p>
<ul>
<li>Ici on créé simplement une table <code>animals</code></li>

</ul>

</aside>
</section>
<section id="slide-orgae4663a">
<h3 id="orgae4663a"><span class="section-number-3">5.10</span> PDO : insertion : <code>pdo_insert.php</code></h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_create.php";

  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('chien', 'médor')");
  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('vache', 'marguerite')");
  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('souris', 'jerry')");
  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('oiseau', 'titi')");
  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('chat', 'minou')");
  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('poisson', 'némo')");
  $pdo-&gt;exec("INSERT INTO animals (animal_type, animal_name) VALUES ('lapin', 'jeannot')");
  echo "id du dernier animal inséré : ".$pdo-&gt;lastInsertId()."&lt;br&gt;\n";
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_insert.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Après avoir créé la table <code>animals</code> avec l'inclusion du code
<code>pdo_create.php</code>, on insère différentes valeurs et on affiche le
numéro du dernier élément ajouté</li>
<li>Même en réactualisant la page, le numéro reste le même car
l'utilisation de <code>memory</code> en SQLite recréé la table <code>animals</code> à
chaque fois</li>

</ul>

</aside>
</section>
<section id="slide-org154503d">
<h3 id="org154503d"><span class="section-number-3">5.11</span> PDO : sélection</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_insert.php";

  $sql = "SELECT * FROM animals";
  foreach ($pdo-&gt;query($sql) as $row) {
    print $row["animal_type"] ." - ". $row["animal_name"] . "&lt;br /&gt;";
  }
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_select.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>On souhaite récupérer les valeurs dans la table et les afficher. Le
résultat de la méthode <code>query</code> peut être parcouru comme s'il
s'agissait d'un tableau associatif ayant comme clé pour chaque
résultat le nom d'un attribut de la table</li>

</ul>

</aside>
</section>
<section id="slide-org233176e">
<h3 id="org233176e"><span class="section-number-3">5.12</span> PDO : parcours des données</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_insert.php";

  $sql = "SELECT * FROM animals";
  $stmt = $pdo-&gt;query($sql);

  echo "&lt;br&gt;&lt;b&gt;PDO::FETCH_ASSOC&lt;/b&gt;&lt;br&gt;\n";
  var_dump($stmt-&gt;fetch(PDO::FETCH_ASSOC));

  echo "&lt;br&gt;&lt;b&gt;PDO::FETCH_NUM&lt;/b&gt;&lt;br&gt;\n";
  var_dump($stmt-&gt;fetch(PDO::FETCH_NUM));

  echo "&lt;br&gt;&lt;b&gt;PDO::FETCH_BOTH&lt;/b&gt;&lt;br&gt;\n";
  var_dump($stmt-&gt;fetch(PDO::FETCH_BOTH));

  echo "&lt;br&gt;&lt;b&gt;fetchAll&lt;/b&gt;&lt;br&gt;\n";
  var_dump($stmt-&gt;fetchAll(PDO::FETCH_ASSOC));
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_select_fetch.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>On peut récupérer les résultats d'une requête de différente façon.
<ul>
<li>La méthode <code>fetch</code> permet de récupérer le premier résultat en cours
<ul>
<li>Le paramètre permet de récupérer le résultat sous forme de
tableau indexé par des numéros <code>PDO::FETCH_NUM</code>, les noms des
attributs <code>PDO::FETCH_ASSOC</code> ou les 2 <code>PDO::FETCH_BOTH</code> (en
pratique le nom des attributs est le plus utile et le plus sûr)</li>

</ul></li>
<li>La méthode <code>fetchAll</code> permet de récupérer tous les résultats qui
restent (si cette méthode est appelée toute seule au début, elle
permet de récupérer tous les résultats de la requête)
<ul>
<li>Les mêmes paramètres que <code>fetch</code> sont disponibles</li>
<li>dans l'exemple, cela ne retourne que les résultats restants, les
3 premiers appels de <code>fetch</code> ayant récupérés les 3 premiers
résultats</li>

</ul></li>

</ul></li>

</ul>

</aside>
</section>
<section id="slide-orgbcbf21e">
<h3 id="orgbcbf21e"><span class="section-number-3">5.13</span> PDO : mise à jour</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_insert.php";

  $count = $pdo-&gt;exec("UPDATE animals SET animal_name='mickey' WHERE animal_name='jerry'");

  echo $count." animaux mis à jour&lt;br&gt;";
  var_dump($pdo-&gt;query("SELECT * FROM animals")-&gt;fetchAll(PDO::FETCH_ASSOC));
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_update.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>la méthode <code>exec</code> retourne le nombre de lignes affectées par la
requête, ici ça nous donne donc le nombre d'animaux qui ont été mis
à jour</li>

</ul>

</aside>
</section>
<section id="slide-orga6b1d86">
<h3 id="orga6b1d86"><span class="section-number-3">5.14</span> PDO : suppression</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_insert.php";

  $count = $pdo-&gt;exec("DELETE FROM animals
                       WHERE animal_name = 'médor' OR animal_name = 'titi'");

  echo $count." animaux supprimés&lt;br&gt;";
  var_dump($pdo-&gt;query("SELECT * FROM animals")-&gt;fetchAll(PDO::FETCH_ASSOC));
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_delete.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Ici ça nous donne donc le nombre d'animaux qui ont été supprimés</li>

</ul>

</aside>
</section>
<section id="slide-orgb98f7bd">
<h3 id="orgb98f7bd"><span class="section-number-3">5.15</span> PDO : préparation</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_insert.php";

  // préparation d'une déclaration SQL
  $stmt = $pdo-&gt;prepare("SELECT * FROM animals
                         WHERE animal_name = :animal_name");

  // déclaration d'une variable
  $animal_name = "minou";

  // lien entre la déclaration SQL et la variable
  $stmt-&gt;bindParam(":animal_name", $animal_name);

  // exécution de la requête et affichage des résultats
  $stmt-&gt;execute();
  var_dump($stmt-&gt;fetchAll());

  // modification des paramètres
  $animal_name = "titi";
  $stmt-&gt;execute();
  var_dump($stmt-&gt;fetchAll());
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_prepare.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Afin d'éviter des failles de sécurité (injection SQL) il ne faut pas
utiliser de variables directement dans la chaîne de caractères
représentant la requête</li>
<li><code>$pdo-&gt;query('SELECT * FROM animals WHERE animal_name = '.$name);</code></li>
<li>Imaginer que <code>$name</code> provienne d'une donnée reçue et que cette
dernière contienne <code>"toto"; DELETE FROM animals;</code></li>
<li>Pour paramétrer une requête il faut donc la préparer et donner un
nom au paramètre par exemple <code>:animal_name</code></li>
<li>L'utilisation de <code>bindParam</code> permet d'associer la valeur au
paramètre et c'est cette méthode qui vérifiera qu'il n'y a pas de
risque de sécurité avec le paramètre</li>
<li>Cette préparation de requête permet ensuite de se resservir de la
même requête en changeant le paramètre, ici le nom de l'animal</li>

</ul>

</aside>
</section>
<section id="slide-orge89f222">
<h3 id="orge89f222"><span class="section-number-3">5.16</span> PDO : fermeture du curseur</h3>
<div class="org-src-container">

<pre  class="src src-c"><code trim>&lt;?php
  include "pdo_insert.php";

  // Création d'un objet PDOStatement
  $stmt = $pdo-&gt;prepare("SELECT animal_id FROM animals");

  // Création d'un second objet PDOStatement
  $otherStmt = $pdo-&gt;prepare("SELECT animal_name FROM animals");

  // Exécute la première requête
  $stmt-&gt;execute();

  // Récupération de la première ligne uniquement depuis le résultat
  var_dump($stmt-&gt;fetch());

  // L'appel suivant à closeCursor() peut être requis par quelques drivers
  $stmt-&gt;closeCursor();

  // Maintenant, nous pouvons exécuter la deuxième requête
  $otherStmt-&gt;execute();

  // Récupération de la première ligne uniquement depuis le résultat
  var_dump($otherStmt-&gt;fetch());
?&gt;
</code></pre>
</div>

<p>
<a href="./examples/pdo_close_cursor.php">exemple</a>
</p>

<aside class="notes">
<ul>
<li>Pour éviter certains problèmes dans le cas d'utilisation de
plusieurs requêtes en parallèle, il faut utiliser la méthode
<code>closeCursor</code> qui permet de s'assurer que notre requête sera
exécutée correctement même si d'autres requêtes avait été exécutées
avant.</li>

</ul>

</aside>
</section>
</section>
</div>
</div>
<div id="reveal-styles"><ul><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/default.css'); return false;" href="#">Black</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/blood.css'); return false;" href="#">Blood</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/sky.css'); return false;" href="#">Sky</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/beige.css'); return false;" href="#">Beige</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/simple.css'); return false;" href="#">Simple</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/serif.css'); return false;" href="#">Serif</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/night.css'); return false;" href="#">Night</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/moon.css'); return false;" href="#">Moon</a></li><li><a onclick="document.getElementById('theme').setAttribute('href','../common/lib/reveal/theme/solarized.css'); return false;" href="#">Solarized</a></li></ul></div>
<script src="../common/lib/reveal/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
width:1800, height:1200, progress:true, history:true, control:true, rolling_links:true, keyboard:true, overview:true, hash: false, slideNumber:true,
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
{ src : '../common/lib/phpjs/php.min.js' }, { src : '../common/lib/codemirror/codemirror.js' }, { src : '../common/lib/codemirror/mode/htmlmixed/htmlmixed.js' }, { src : '../common/lib/codemirror/mode/xml/xml.js' }, { src : '../common/lib/codemirror/mode/php/php.js' }, { src : '../common/lib/codemirror/mode/javascript/javascript.js' }, { src : '../common/lib/codemirror/mode/clike/clike.js' }, { src : '../common/lib/codemirror/mode/css/css.js' }, { src : '../common/lib/codemirror/addon/display/autorefresh.js' }, { src : '../common/lib/split/split-grid.js' }, { src : '../common/inc/js/console.js'},
 { src: '../common/lib/reveal/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
